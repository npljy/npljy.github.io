<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>前端壹菜鸟</title>
  
  <subtitle>关注前端知识，收集精彩博文，做技术的搬运工</subtitle>
  <link href="https://xuehuayu.cn/atom.xml" rel="self"/>
  
  <link href="https://xuehuayu.cn/"/>
  <updated>2025-12-04T09:10:12.218Z</updated>
  <id>https://xuehuayu.cn/</id>
  
  <author>
    <name>搬砖大老</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>又拍云注销账号退款结果</title>
    <link href="https://xuehuayu.cn/article/90947add.html"/>
    <id>https://xuehuayu.cn/article/90947add.html</id>
    <published>2025-12-03T18:05:02.000Z</published>
    <updated>2025-12-04T09:10:12.218Z</updated>
    
    <content type="html"><![CDATA[<p>经过个人的持续跟进以及相关方面的协调，本人已于近日收到了又拍云的账户余额退款。此事虽已了结，但过程中的种种障碍，仍足以成为企业审视自身服务流程的案例。</p><span id="more"></span><p>此次经历表明，用户与平台之间的权责对等不仅应体现在服务提供时，也应延续至服务终止的环节。合理的退款机制，应当是以用户便利为本、以信息安全为基，而非设置冗余步骤。尽管最终的结果符合预期，但消耗的时间与精力，本可通过更友善的流程设计得以避免。</p><p>但愿此次事件能为又拍云及其他平台带来反思：真正的服务口碑，不仅建立于用户到来时的便捷，更体现于用户离开时的尊重与顺畅。</p><h3 id="事情经过"><a href="#事情经过" class="headerlink" title="事情经过"></a>事情经过</h3><p><a href="/article/40a96678.html">又拍云注销账号退款：一场本不该如此“恶心”的用户告别</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;经过个人的持续跟进以及相关方面的协调，本人已于近日收到了又拍云的账户余额退款。此事虽已了结，但过程中的种种障碍，仍足以成为企业审视自身服务流程的案例。&lt;/p&gt;</summary>
    
    
    
    <category term="又拍云" scheme="https://xuehuayu.cn/categories/%E5%8F%88%E6%8B%8D%E4%BA%91/"/>
    
    
    <category term="又拍云" scheme="https://xuehuayu.cn/tags/%E5%8F%88%E6%8B%8D%E4%BA%91/"/>
    
    <category term="注销" scheme="https://xuehuayu.cn/tags/%E6%B3%A8%E9%94%80/"/>
    
  </entry>
  
  <entry>
    <title>又拍云注销账号退款：一场本不该如此“恶心”的用户告别</title>
    <link href="https://xuehuayu.cn/article/40a96678.html"/>
    <id>https://xuehuayu.cn/article/40a96678.html</id>
    <published>2025-12-02T14:32:22.000Z</published>
    <updated>2025-12-04T09:10:12.218Z</updated>
    
    <content type="html"><![CDATA[<p>最近决定将个人博客的加速服务从又拍云切换到其他平台，本以为注销账号、取回余额是一个简单的流程，却没想到，这竟成了一场令人倍感“恶心”的拉锯战。</p><span id="more"></span><h3 id="注销难，退款更难"><a href="#注销难，退款更难" class="headerlink" title="注销难，退款更难"></a><strong>注销难，退款更难</strong></h3><p>在又拍云平台上，我既找不到注销账号的入口，也找不到余额退款的选项。几经周折后联系客服，才被告知需要填写工单、添加微信，并提交一份名为“又拍云（UPYUN.com）退款申请单”的表格（文章末尾附件）。而这份表格要求的信息之多，堪称“豪华套餐”：</p><ul><li>姓名、电话</li><li>单位信息（重复填写）</li><li>充值时间</li><li><strong>身份证正反面</strong></li><li><strong>亲笔签名</strong></li></ul><p>而这些内容，最终需要通过微信发送给客服。随后，还需等待<strong>5-10个工作日</strong>才能知道结果。</p><p>客服对此的解释是：“账号是实名制的，所以退款需要这些信息。”然而，当初充值的时候，又拍云并未要求提交如此繁琐的个人资料。如今想要拿回属于自己的几块钱余额，却要经历如此复杂的流程，这难道不是人为设置的高门槛？</p><h3 id="为什么说这是“增加门槛”？"><a href="#为什么说这是“增加门槛”？" class="headerlink" title="为什么说这是“增加门槛”？"></a><strong>为什么说这是“增加门槛”？</strong></h3><p>从逻辑上看，退款流程本可以更简洁、更安全：</p><ol><li><strong>账号登录验证</strong>：用户已通过账号密码、手机验证码登录；</li><li><strong>工单系统</strong>：用户已在工单中提交申请；</li><li><strong>支付实名信息</strong>：支付宝本身就是实名制，平台完全可以通过验证用户绑定的支付宝账号进行退款。</li></ol><p>即使考虑到支付宝账号可能存在重名的情况，结合以上多重验证，身份混淆的概率也微乎其微。又拍云当前的做法，更像是在利用繁琐的流程<strong>劝退用户</strong>，让大多数人因为怕麻烦而放弃退款。</p><h3 id="几块钱，值得如此大动干戈吗？"><a href="#几块钱，值得如此大动干戈吗？" class="headerlink" title="几块钱，值得如此大动干戈吗？"></a><strong>几块钱，值得如此大动干戈吗？</strong></h3><p>或许有人会说：“用了两年免费服务，几块钱还要退？”</p><p>但问题不在于金额大小，而在于<strong>原则</strong>。用户选择免费服务，是建立在遵守平台规则的基础上，而不是“默认放弃余额”。既然余额属于用户，平台就有义务提供合理的退款渠道。用高门槛阻挡用户取回自己的钱，本质上是对用户权益的漠视。</p><h3 id="用户体验，不应止于“收费前”"><a href="#用户体验，不应止于“收费前”" class="headerlink" title="用户体验，不应止于“收费前”"></a><strong>用户体验，不应止于“收费前”</strong></h3><p>一家企业的服务品质，不仅体现在用户使用过程中，更体现在用户离开时的体验。又拍云在推广期提供便利的充值入口，而在退款时却设置重重障碍，这种“前后不一”的做法，无疑会损耗用户的信任。</p><p>我们希望又拍云能够反思当前的退款流程：简化步骤、保护用户隐私、提升处理效率，让用户的告别也能体面而顺畅。</p><hr><p><strong>用户的钱，无论多少，都值得被尊重。</strong><br><strong>企业的口碑，恰恰藏在那些容易被忽略的细节里。</strong></p><h3 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h3><p><img src="https://s2.loli.net/2025/12/02/E9KtSgNc4LFq3oM.jpg" alt="_20251202145659_24_3.jpg"></p><h3 id="最终结果"><a href="#最终结果" class="headerlink" title="最终结果"></a>最终结果</h3><p><a href="/article/90947add.html">又拍云注销账号退款结果</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近决定将个人博客的加速服务从又拍云切换到其他平台，本以为注销账号、取回余额是一个简单的流程，却没想到，这竟成了一场令人倍感“恶心”的拉锯战。&lt;/p&gt;</summary>
    
    
    
    <category term="又拍云" scheme="https://xuehuayu.cn/categories/%E5%8F%88%E6%8B%8D%E4%BA%91/"/>
    
    
    <category term="又拍云" scheme="https://xuehuayu.cn/tags/%E5%8F%88%E6%8B%8D%E4%BA%91/"/>
    
    <category term="注销" scheme="https://xuehuayu.cn/tags/%E6%B3%A8%E9%94%80/"/>
    
  </entry>
  
  <entry>
    <title>本站已全面接入腾讯edgeone</title>
    <link href="https://xuehuayu.cn/article/87ba5860.html"/>
    <id>https://xuehuayu.cn/article/87ba5860.html</id>
    <published>2025-11-24T14:30:21.000Z</published>
    <updated>2025-12-04T09:10:12.217Z</updated>
    
    <content type="html"><![CDATA[<p>本站已全面接入腾讯edgeone，国内延迟在50ms以内。</p><span id="more"></span><p>本站代码在github，静态服务托管在 cloudflare 和 vercel，<br><a href="https://www.xuehuayu.cn/">xuehuayu.cn</a>现在已全面接入腾讯edgeone国内版，国内延迟在50ms以内。<br><a href="https://www.cainiaoblog.cn/">cainiaoblog.cn</a>现在已全面接入腾讯edgeone国际版。</p><p>如果你在配置过程中有任何问题，请在下方留言。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;本站已全面接入腾讯edgeone，国内延迟在50ms以内。&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>使用 Vercel + Upstash Redis 搭建自己的加速缓存服务</title>
    <link href="https://xuehuayu.cn/article/68c9c2c2.html"/>
    <id>https://xuehuayu.cn/article/68c9c2c2.html</id>
    <published>2025-11-21T10:57:00.000Z</published>
    <updated>2025-12-04T09:10:12.216Z</updated>
    
    <content type="html"><![CDATA[<p>在现代 Web 开发中，性能优化至关重要。缓存是提升应用响应速度、降低后端负载的常用手段。然而，传统缓存方案（如自建 Redis 服务器）往往需要运维成本和复杂的部署流程。<br>本文将带你使用 <strong>Vercel</strong> 和 <strong>Upstash Redis</strong> 快速搭建一个轻量、无服务器（Serverless）的加速缓存服务，适用于 API 响应缓存、页面静态化、用户会话存储等场景。</p><span id="more"></span><hr><h2 id="为什么选择-Vercel-Upstash？"><a href="#为什么选择-Vercel-Upstash？" class="headerlink" title="为什么选择 Vercel + Upstash？"></a>为什么选择 Vercel + Upstash？</h2><ul><li><strong>Vercel</strong>：领先的前端部署平台，支持 Serverless Functions、Edge Functions，自动全球 CDN 加速。</li><li><strong>Upstash Redis</strong>：专为 Serverless 架构设计的 Redis 服务，按请求计费、低延迟、无需管理连接池，完美适配 Vercel 的无状态函数模型。</li></ul><p>两者结合，可以实现“零运维、高可用、全球低延迟”的缓存服务。</p><hr><h2 id="第一步：创建-Upstash-Redis-数据库"><a href="#第一步：创建-Upstash-Redis-数据库" class="headerlink" title="第一步：创建 Upstash Redis 数据库"></a>第一步：创建 Upstash Redis 数据库</h2><ol><li>访问 <a href="https://upstash.com/">https://upstash.com</a> 并注册账号。</li><li>进入控制台，点击 <strong>Create Database</strong>。</li><li>选择区域（建议选离你用户最近的，或使用 Global Database 实现多区域同步）。</li><li>创建完成后，你会获得：<ul><li><strong>REST URL</strong></li><li><strong>Token</strong>（用于认证）</li></ul></li></ol><blockquote><p>⚠️ 注意：Upstash 提供 REST API 接口访问 Redis，非常适合 Serverless 环境，避免了 TCP 连接池问题。</p></blockquote><hr><h2 id="第二步：在-Vercel-中设置环境变量"><a href="#第二步：在-Vercel-中设置环境变量" class="headerlink" title="第二步：在 Vercel 中设置环境变量"></a>第二步：在 Vercel 中设置环境变量</h2><p>进入你的 Vercel 项目 → Settings → Environment Variables，添加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPSTASH_REDIS_REST_URL = https://xxxxx.upstash.io</span><br><span class="line">UPSTASH_REDIS_REST_TOKEN = your-token-here</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>确保这些变量在部署时可用。</p><hr><h2 id="第三步：编写缓存逻辑（Node-js-示例）"><a href="#第三步：编写缓存逻辑（Node-js-示例）" class="headerlink" title="第三步：编写缓存逻辑（Node.js 示例）"></a>第三步：编写缓存逻辑（Node.js 示例）</h2><p>我们以一个简单的 API 路由为例：缓存 GitHub 用户信息。</p><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install @upstash/redis</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="创建-API-路由（pages-api-user-username-js）"><a href="#创建-API-路由（pages-api-user-username-js）" class="headerlink" title="创建 API 路由（pages/api/user/[username].js）"></a>创建 API 路由（<code>pages/api/user/[username].js</code>）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Redis</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@upstash/redis&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> redis = <span class="keyword">new</span> <span class="title class_">Redis</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: process.<span class="property">env</span>.<span class="property">UPSTASH_REDIS_REST_URL</span>,</span><br><span class="line">  <span class="attr">token</span>: process.<span class="property">env</span>.<span class="property">UPSTASH_REDIS_REST_TOKEN</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username &#125; = req.<span class="property">query</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 尝试从缓存读取</span></span><br><span class="line">  <span class="keyword">const</span> cached = <span class="keyword">await</span> redis.<span class="title function_">get</span>(<span class="string">`user:<span class="subst">$&#123;username&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">if</span> (cached) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Cache hit&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123; <span class="attr">source</span>: <span class="string">&#x27;cache&#x27;</span>, <span class="attr">data</span>: cached &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 缓存未命中，请求 GitHub API</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Cache miss, fetching from GitHub&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> githubRes = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/users/<span class="subst">$&#123;username&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">const</span> userData = <span class="keyword">await</span> githubRes.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!githubRes.<span class="property">ok</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(githubRes.<span class="property">status</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;User not found&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 写入缓存，有效期 5 分钟</span></span><br><span class="line">  <span class="keyword">await</span> redis.<span class="title function_">setex</span>(<span class="string">`user:<span class="subst">$&#123;username&#125;</span>`</span>, <span class="number">300</span>, userData);</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123; <span class="attr">source</span>: <span class="string">&#x27;github&#x27;</span>, <span class="attr">data</span>: userData &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h2 id="第四步：部署到-Vercel"><a href="#第四步：部署到-Vercel" class="headerlink" title="第四步：部署到 Vercel"></a>第四步：部署到 Vercel</h2><p>只需 <code>git push</code> 到关联的仓库，Vercel 会自动构建并部署。</p><p>测试接口：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET https://your-app.vercel.app/api/user/octocat</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>首次访问会调用 GitHub API 并缓存结果；后续 5 分钟内访问将直接返回缓存数据。</p><hr><h2 id="进阶技巧"><a href="#进阶技巧" class="headerlink" title="进阶技巧"></a>进阶技巧</h2><h3 id="1-使用-Edge-Functions-降低延迟"><a href="#1-使用-Edge-Functions-降低延迟" class="headerlink" title="1. 使用 Edge Functions 降低延迟"></a>1. 使用 Edge Functions 降低延迟</h3><p>Vercel 的 Edge Functions 运行在全球边缘节点，配合 Upstash 的全球数据库，可实现毫秒级响应。</p><p>只需将文件放在 <code>app/api/.../route.ts</code>（Next.js App Router），并导出 <code>runtime: &#39;edge&#39;</code>：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> runtime = <span class="string">&#x27;edge&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">GET</span>(<span class="params">request: Request, &#123; params &#125;: &#123; params: &#123; username: <span class="built_in">string</span> &#125; &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 同上逻辑，但运行在边缘</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-缓存策略优化"><a href="#2-缓存策略优化" class="headerlink" title="2. 缓存策略优化"></a>2. 缓存策略优化</h3><ul><li>对频繁变化的数据：缩短 TTL（如 60 秒）</li><li>对静态内容：延长 TTL（如 1 小时）</li><li>使用 <code>redis.del()</code> 主动失效缓存（如用户更新资料后）</li></ul><h3 id="3-监控与成本控制"><a href="#3-监控与成本控制" class="headerlink" title="3. 监控与成本控制"></a>3. 监控与成本控制</h3><p>Upstash 按请求次数计费（免费额度足够个人项目）。可在控制台查看用量，设置警报。</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过 <strong>Vercel + Upstash Redis</strong>，我们仅用几十行代码就搭建了一个高性能、全球分布的缓存服务。这种组合特别适合：</p><ul><li>Next.js &#x2F; Nuxt 等现代框架项目</li><li>需要缓存第三方 API 响应的场景</li><li>无服务器架构下的状态共享（如限流、会话）</li></ul><p>无需担心 Redis 连接、扩容、备份等问题，真正实现“专注业务，缓存无忧”。</p><hr><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul><li>Upstash Redis: <a href="https://upstash.com/redis">https://upstash.com/redis</a></li><li>Vercel 文档: <a href="https://vercel.com/docs">https://vercel.com/docs</a></li><li>@upstash&#x2F;redis SDK: <a href="https://github.com/upstash/upstash-redis">https://github.com/upstash/upstash-redis</a></li></ul><p>如果你觉得这篇文章有帮助，欢迎点赞、分享，或在评论区留下你的实践心得！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在现代 Web 开发中，性能优化至关重要。缓存是提升应用响应速度、降低后端负载的常用手段。然而，传统缓存方案（如自建 Redis 服务器）往往需要运维成本和复杂的部署流程。&lt;br&gt;本文将带你使用 &lt;strong&gt;Vercel&lt;/strong&gt; 和 &lt;strong&gt;Upstash Redis&lt;/strong&gt; 快速搭建一个轻量、无服务器（Serverless）的加速缓存服务，适用于 API 响应缓存、页面静态化、用户会话存储等场景。&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Frontend" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/Frontend/"/>
    
    <category term="Redis" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/Frontend/Redis/"/>
    
    <category term="Vercel" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/Frontend/Redis/Vercel/"/>
    
    
    <category term="Vercel" scheme="https://xuehuayu.cn/tags/Vercel/"/>
    
    <category term="Redis" scheme="https://xuehuayu.cn/tags/Redis/"/>
    
    <category term="Serverless" scheme="https://xuehuayu.cn/tags/Serverless/"/>
    
    <category term="缓存" scheme="https://xuehuayu.cn/tags/%E7%BC%93%E5%AD%98/"/>
    
    <category term="性能优化" scheme="https://xuehuayu.cn/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>账号被封了？被担心，不是！是Cloudflare崩了！</title>
    <link href="https://xuehuayu.cn/article/46124b4e.html"/>
    <id>https://xuehuayu.cn/article/46124b4e.html</id>
    <published>2025-11-18T19:53:35.000Z</published>
    <updated>2025-12-04T09:10:12.215Z</updated>
    
    <content type="html"><![CDATA[<p>账号被封了？被担心，不是！是Cloudflare崩了！</p><span id="more"></span><p>别担心，不是你的账号被封了。<br>是的，全球 50% 的网站不能访问了。2025年11月18日Cloudflare发生了全球性的技术故障。</p><p>此次故障大约始于英国时间上午11点30分（世界协调时间11:30左右），导致大量依赖其服务的网站和平台访问异常，像社交平台X（原Twitter）、OpenAI的ChatGPT等都出现了页面无法加载的情况，用户普遍收到“Cloudflare网络内部服务器错误”提示，不少网站还报出500错误。就连监测网络中断的Down Detector网站也受此波及，短暂无法正常加载。</p><p>Cloudflare在故障发生约15分钟后发布首次通告，确认问题并展开调查，后续又更新声明称仍在调查中，暂未找到故障根源与解决办法，后续会公布更多详细信息。</p><p>截至 北京时间 2025年11月18日21点42分，Cloudflare已恢复服务。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;账号被封了？被担心，不是！是Cloudflare崩了！&lt;/p&gt;</summary>
    
    
    
    <category term="CDN" scheme="https://xuehuayu.cn/categories/CDN/"/>
    
    <category term="网站" scheme="https://xuehuayu.cn/categories/CDN/%E7%BD%91%E7%AB%99/"/>
    
    
    <category term="Cloudflare" scheme="https://xuehuayu.cn/tags/Cloudflare/"/>
    
  </entry>
  
  <entry>
    <title>预览img图片文件pdf文件如何鉴权配置请求头token</title>
    <link href="https://xuehuayu.cn/article/de24b120.html"/>
    <id>https://xuehuayu.cn/article/de24b120.html</id>
    <published>2025-11-16T15:35:10.000Z</published>
    <updated>2025-12-04T09:10:12.214Z</updated>
    
    <content type="html"><![CDATA[<p>如何在前端为 <code>&lt;img&gt;</code> 和 PDF 资源请求添加自定义请求头</p><p>在现代 Web 开发中，我们经常需要加载受权限保护的资源，比如带有身份认证（如 Bearer Token）的图片或 PDF 文件。然而，标准 HTML 中的 <code>&lt;img&gt;</code> 标签、<code>&lt;iframe&gt;</code> 或 <code>&lt;object&gt;</code> 等元素<strong>无法直接配置 HTTP 请求头</strong>。这意味着你不能像使用 <code>fetch</code> 那样，在标签层面传递 <code>Authorization</code>、<code>X-API-Key</code> 等头部信息。</p><p>但这并不意味着无解！本文将为你详细拆解如何通过“曲线救国”的方式——先用 JavaScript 获取受保护资源，再将其转换为可嵌入页面的数据 URL 或 Blob URL，从而实现带请求头加载图片和 PDF 的需求。</p><hr><h2 id="一、为什么-不能设置请求头？"><a href="#一、为什么-不能设置请求头？" class="headerlink" title="一、为什么 &lt;img&gt; 不能设置请求头？"></a>一、为什么 <code>&lt;img&gt;</code> 不能设置请求头？</h2><p>HTML 原生标签（如 <code>&lt;img src=&quot;...&quot;&gt;</code>）发起的请求是由浏览器自动处理的，开发者无法干预其请求头。这是出于安全和简洁性的设计考量。因此，若服务器要求特定请求头（如 JWT Token），直接使用 <code>&lt;img&gt;</code> 将导致 401&#x2F;403 错误。</p><p><strong>解决方案的核心思路</strong>：</p><blockquote><p>使用 <code>fetch</code> 或 <code>XMLHttpRequest</code> 手动发起带请求头的请求 → 获取二进制数据 → 转换为 <code>Blob URL</code> → 赋值给 <code>&lt;img&gt;</code> 或 <code>&lt;iframe&gt;</code> 的 <code>src</code>。</p></blockquote><hr><h2 id="二、加载带认证头的图片"><a href="#二、加载带认证头的图片" class="headerlink" title="二、加载带认证头的图片"></a>二、加载带认证头的图片</h2><h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><ol><li>使用 <code>fetch</code> 请求图片资源，并在 <code>headers</code> 中添加认证信息；</li><li>将响应转为 <code>Blob</code> 对象；</li><li>通过 <code>URL.createObjectURL(blob)</code> 生成本地 URL；</li><li>将该 URL 赋给 <code>&lt;img&gt;</code> 的 <code>src</code> 属性；</li><li>图片加载完成后，调用 <code>URL.revokeObjectURL()</code> 释放内存。</li></ol><h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadImageWithAuth</span>(<span class="params">url, token, imgElement</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="title class_">Authorization</span>: <span class="string">&#x27;Bearer &#x27;</span> + token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!res.<span class="property">ok</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Failed to load image&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">await</span> res.<span class="title function_">blob</span>();</span><br><span class="line">    <span class="keyword">const</span> objectUrl = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line"></span><br><span class="line">    imgElement.<span class="property">src</span> = objectUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理内存：图片加载完成后释放 Blob URL</span></span><br><span class="line">    imgElement.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(objectUrl);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading image:&#x27;</span>, error);</span><br><span class="line">    imgElement.<span class="property">src</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 可选：显示占位图或错误提示</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> img = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;protected-image&#x27;</span>);</span><br><span class="line"><span class="title function_">loadImageWithAuth</span>(<span class="string">&#x27;https://api.example.com/image.jpg&#x27;</span>, <span class="string">&#x27;your-jwt-token&#x27;</span>, img);</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>✅ <strong>优点</strong>：兼容性好（现代浏览器均支持 <code>fetch</code> 和 <code>Blob URL</code>）；<br>⚠️ <strong>注意</strong>：频繁创建未释放的 Blob URL 会导致内存泄漏，务必在 <code>onload</code> 或组件销毁时调用 <code>revokeObjectURL</code>。</p></blockquote><hr><h2 id="三、加载带认证头的-PDF-并在页面预览"><a href="#三、加载带认证头的-PDF-并在页面预览" class="headerlink" title="三、加载带认证头的 PDF 并在页面预览"></a>三、加载带认证头的 PDF 并在页面预览</h2><p>PDF 文件通常通过 <code>&lt;iframe&gt;</code>、<code>&lt;embed&gt;</code> 或 PDF.js 渲染。与图片类似，这些标签也无法携带请求头。我们可以用相同思路：先获取 PDF 的二进制流，再生成可嵌入的 URL。</p><h3 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h3><ol><li>用 <code>fetch</code> 获取 PDF 资源（带 <code>Authorization</code> 头）；</li><li>读取 <code>response.body</code> 的 <code>ReadableStream</code>；</li><li>将流数据分块收集并合并为 <code>Blob</code>；</li><li>创建 <code>Blob URL</code> 并赋给 <code>&lt;iframe&gt;</code> 的 <code>src</code>。</li></ol><h3 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadPdfWithAuth</span>(<span class="params">url, token, iframeElement</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="title class_">Authorization</span>: <span class="string">&#x27;Bearer &#x27;</span> + token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!res.<span class="property">ok</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Failed to load PDF&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reader = res.<span class="property">body</span>.<span class="title function_">getReader</span>();</span><br><span class="line">    <span class="keyword">const</span> chunks = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; done, value &#125; = <span class="keyword">await</span> reader.<span class="title function_">read</span>();</span><br><span class="line">      <span class="keyword">if</span> (done) <span class="keyword">break</span>;</span><br><span class="line">      chunks.<span class="title function_">push</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>(chunks, &#123; <span class="attr">type</span>: <span class="string">&#x27;application/pdf&#x27;</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> objectUrl = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line"></span><br><span class="line">    iframeElement.<span class="property">src</span> = objectUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理内存</span></span><br><span class="line">    iframeElement.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(objectUrl);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading PDF:&#x27;</span>, error);</span><br><span class="line">    iframeElement.<span class="property">src</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 或跳转到错误页面</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> pdfIframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;pdf-preview&#x27;</span>);</span><br><span class="line"><span class="title function_">loadPdfWithAuth</span>(<span class="string">&#x27;https://api.example.com/report.pdf&#x27;</span>, <span class="string">&#x27;your-jwt-token&#x27;</span>, pdfIframe);</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>🔍 <strong>替代方案</strong>：如果你使用 <a href="https://mozilla.github.io/pdf.js/">PDF.js</a>，可以直接传入 <code>Uint8Array</code> 或 <code>ArrayBuffer</code>，无需生成 Blob URL，更灵活且支持分页、缩放等高级功能。</p></blockquote><hr><h2 id="四、注意事项与最佳实践"><a href="#四、注意事项与最佳实践" class="headerlink" title="四、注意事项与最佳实践"></a>四、注意事项与最佳实践</h2><table><thead><tr><th>项目</th><th>建议</th></tr></thead><tbody><tr><td><strong>内存管理</strong></td><td>务必在资源加载完成后调用 <code>URL.revokeObjectURL()</code>，避免内存泄漏</td></tr><tr><td><strong>错误处理</strong></td><td>网络失败、认证过期等情况需有用户友好的反馈</td></tr><tr><td><strong>CORS 问题</strong></td><td>确保后端设置了正确的 CORS 头（如 <code>Access-Control-Allow-Origin</code>）</td></tr><tr><td><strong>大文件性能</strong></td><td>对于超大图片&#x2F;PDF，考虑分块加载或懒加载，避免阻塞主线程</td></tr><tr><td><strong>缓存策略</strong></td><td><code>fetch</code> 默认不走浏览器缓存，如需缓存可配合 <code>Cache API</code> 或服务端协商缓存</td></tr></tbody></table><hr><h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><p>虽然 HTML 原生标签无法直接设置请求头，但借助现代 Web API（<code>fetch</code> + <code>Blob</code> + <code>URL.createObjectURL</code>），我们完全可以优雅地绕过这一限制。无论是私有图片、加密 PDF，还是其他二进制资源，只要能通过 JavaScript 获取，就能安全地嵌入页面。</p><blockquote><p><strong>记住</strong>：这不是 hack，而是标准 Web 平台能力的合理组合。</p></blockquote><p>希望本文能帮你解决实际开发中的权限资源加载难题。如有更复杂的场景（如流式渲染 PDF、图片懒加载 + 认证），也欢迎进一步探讨！</p><hr><p><strong>延伸阅读</strong>：</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL">MDN: URL.createObjectURL()</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">Using Fetch - MDN</a></li><li><a href="https://mozilla.github.io/pdf.js/">PDF.js 官方文档</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;如何在前端为 &lt;code&gt;&amp;lt;img&amp;gt;&lt;/code&gt; 和 PDF 资源请求添加自定义请求头&lt;/p&gt;
&lt;p&gt;在现代 Web 开发中，我们经常需要加载受权限保护的资源，比如带有身份认证（如 Bearer Token）的图片或 PDF 文件。然而，标准 HTML 中的 </summary>
      
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Frontend" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/Frontend/"/>
    
    <category term="PDF" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/Frontend/PDF/"/>
    
    <category term="Image" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/Frontend/PDF/Image/"/>
    
    <category term="请求头" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/Frontend/PDF/Image/%E8%AF%B7%E6%B1%82%E5%A4%B4/"/>
    
    
    <category term="img标签" scheme="https://xuehuayu.cn/tags/img%E6%A0%87%E7%AD%BE/"/>
    
    <category term="pdf文件" scheme="https://xuehuayu.cn/tags/pdf%E6%96%87%E4%BB%B6/"/>
    
    <category term="请求头" scheme="https://xuehuayu.cn/tags/%E8%AF%B7%E6%B1%82%E5%A4%B4/"/>
    
    <category term="鉴权" scheme="https://xuehuayu.cn/tags/%E9%89%B4%E6%9D%83/"/>
    
    <category term="预览" scheme="https://xuehuayu.cn/tags/%E9%A2%84%E8%A7%88/"/>
    
  </entry>
  
  <entry>
    <title>手机丢失该怎么办？手机防盗防丢完全指南</title>
    <link href="https://xuehuayu.cn/article/472c582b.html"/>
    <id>https://xuehuayu.cn/article/472c582b.html</id>
    <published>2025-11-03T10:27:09.000Z</published>
    <updated>2025-12-04T09:10:12.213Z</updated>
    
    <content type="html"><![CDATA[<p>手机开启“丢失模式”后的主要安全功能和注意事项，旨在保护失主隐私、协助定位设备，并增加小偷的处理难度。</p><span id="more"></span><p>以下是对这些要点的清晰归纳：</p><hr><h3 id="手机丢失模式的核心功能与作用"><a href="#手机丢失模式的核心功能与作用" class="headerlink" title="手机丢失模式的核心功能与作用"></a><strong>手机丢失模式的核心功能与作用</strong></h3><ol><li><p><strong>刷机锁死 (Bootloader锁)</strong></p><ul><li>如果手机Bootloader已上锁且开启丢失模式，小偷将无法通过常规手段刷机。手机将始终保持“砖头”状态，除非机主本人解锁。</li></ul></li><li><p><strong>联网激活锁</strong></p><ul><li>任何刷机或恢复出厂设置的操作后，手机需要联网激活。一旦联网，手机就会被定位并锁死，使刷机无效。</li></ul></li><li><p><strong>远程锁定与数据保护</strong></p><ul><li>失主可以远程锁定手机，防止他人访问。</li><li>可以远程触发数据清除功能，保护银行卡、钱包等敏感信息。</li></ul></li><li><p><strong>功能限制</strong></p><ul><li>无法关机：防止小偷通过关机逃避定位。</li><li>无线网络、蓝牙等无法关闭：确保定位功能持续有效。</li></ul></li><li><p><strong>多重定位技术</strong></p><ul><li><strong>实时GPS定位</strong>：通过移动网络或WiFi进行定位。</li><li><strong>无网络定位</strong>：即使拔掉SIM卡，也能通过扫描附近的WiFi网络或蓝牙设备（如他人的手机）来实现精确定位。</li></ul></li><li><p><strong>远程报警</strong></p><ul><li>失主可以远程触发最大音量的报警铃声，即使手机处于静音模式也会响起，有助于在附近（如楼道、房间）定位手机。</li></ul></li><li><p><strong>SIM卡锁</strong></p><ul><li>强烈建议开启SIM卡锁（PIN码）。这样即使手机卡被拔出插入其他手机，也无法使用，防止被用于诈骗等非法活动。</li></ul></li><li><p><strong>法律威慑</strong></p><ul><li>拾获或盗窃手机拒不归还，将面临法律风险。失主报警后，警方可依据定位信息进行处理。</li></ul></li><li><p><strong>失主行动指南</strong></p><ul><li>根据定位找到大致位置后，使用播放铃声功能精确定位，然后报警求助。</li><li>如果手机被迅速转移至外地，找回成本过高，应果断选择远程清除所有数据，并第一时间挂失电话卡，以保护财产安全和个人隐私。</li></ul></li></ol><hr><h3 id="给失主的建议"><a href="#给失主的建议" class="headerlink" title="给失主的建议"></a><strong>给失主的建议</strong></h3><ul><li><strong>预防优于补救</strong>：请务必提前在手机设置中开启“查找我的手机”功能和SIM卡PIN码锁。</li><li><strong>立即行动</strong>：一旦发现手机丢失，应立刻通过电脑或其他设备登录手机品牌的云服务（如iCloud、小米云、华为云等）开启丢失模式。</li><li><strong>保持冷静</strong>：按照上述流程，利用科技手段和法律武器尽可能找回手机或保护数据。</li></ul><p>我们可以从 <strong>“事前预防”、“事中操作”和“事后应对”</strong> 三个维度进行补充和完善，使其成为一个更完整、更具操作性的安全指南。</p><hr><h3 id="手机防盗防丢完全指南"><a href="#手机防盗防丢完全指南" class="headerlink" title="手机防盗防丢完全指南"></a><strong>手机防盗防丢完全指南</strong></h3><h4 id="第一部分：事前预防（最重要的环节）"><a href="#第一部分：事前预防（最重要的环节）" class="headerlink" title="第一部分：事前预防（最重要的环节）"></a><strong>第一部分：事前预防（最重要的环节）</strong></h4><ol><li><p><strong>未雨绸缪，立即设置</strong>：</p><ul><li><strong>开启“查找我的设备”</strong>：这是所有功能的基础。在iPhone上是“查找我的iPhone”，在安卓上是“查找我的设备”，并确保开启“离线查找”或“关机后定位”等高级选项。</li><li><strong>设置锁屏密码和生物识别</strong>：使用复杂的密码&#x2F;图案，并务必开启指纹或面部识别。这是防止小偷访问你数据的第一道屏障。</li><li><strong>强制开启SIM卡PIN码</strong>：这是您提到的第9点，但需要强调其<strong>设置方法</strong>：进入手机设置 -&gt; 蜂窝网络&#x2F;SIM卡与流量管理 -&gt; 选择SIM卡 -&gt; SIM卡PIN码 -&gt; 开启并修改默认PIN码（通常是1234或0000）。这样，手机重启或SIM卡插入别的手机时，必须输入PIN码才能使用网络。</li><li><strong>记录你的手机IMEI号</strong>：在拨号盘输入 <code>*#06#</code> 即可显示。IMEI是手机的唯一身份码，报案时提供给警方，有助于他们追踪设备。</li></ul></li><li><p><strong>日常使用好习惯</strong>：</p><ul><li>在公共场所，手机不要放在宽松的口袋或敞开的包袋中。</li><li>警惕“搭讪”或“碰撞”，这可能是分散你注意力的伎俩。</li></ul></li></ol><h4 id="第二部分：丢失后立即采取的行动（事中操作）"><a href="#第二部分：丢失后立即采取的行动（事中操作）" class="headerlink" title="第二部分：丢失后立即采取的行动（事中操作）"></a><strong>第二部分：丢失后立即采取的行动（事中操作）</strong></h4><ol><li><p><strong>第一步：保持冷静，迅速借设备</strong></p><ul><li>立即借用朋友手机、电脑或任何可联网的设备。</li></ul></li><li><p><strong>第二步：登录云服务</strong></p><ul><li><strong>苹果用户</strong>：访问 <a href="https://www.icloud.com/find">iCloud.com&#x2F;find</a></li><li><strong>华为用户</strong>：访问 <a href="https://cloud.huawei.com/">cloud.huawei.com</a></li><li><strong>小米用户</strong>：访问 <a href="https://i.mi.com/">i.mi.com</a></li><li><strong>三星用户</strong>：访问 <a href="https://findmymobile.samsung.cn/">findmymobile.samsung.cn</a></li><li>其他品牌安卓用户也可使用 Google 的 <a href="https://www.google.com/android/find">Find My Device</a></li></ul></li><li><p><strong>第三步：执行“丢失模式”</strong></p><ul><li>在云服务地图上选择你的设备，然后开启“丢失模式”。</li><li><strong>补充操作</strong>：<ul><li><strong>留下联系方式</strong>：在丢失模式的锁屏界面上，留下一个你可以接听的电话号码（如朋友的）。这给拾获者一个归还的渠道，有时比警报更有效。</li><li><strong>不要立即清空数据</strong>：清空数据会使“查找”功能失效。除非确认无法找回（如手机已到外地），否则先定位和锁定，再考虑清除。</li></ul></li></ul></li></ol><h4 id="第三部分：对原条目的重要补充和修正"><a href="#第三部分：对原条目的重要补充和修正" class="headerlink" title="第三部分：对原条目的重要补充和修正"></a><strong>第三部分：对原条目的重要补充和修正</strong></h4><ol><li><strong>关于“无法关机”</strong>：现代手机在丢失模式下，<strong>通常只是“强烈不建议关机”或“关机需要密码”</strong>，但物理强制重启（长按电源键+音量键）在某些机型上仍然可能实现。因此，<strong>“无法关机”并非绝对</strong>，但确实大大增加了难度。</li><li><strong>关于“刷机&#x2F;解锁”</strong>：<ul><li><strong>“工厂重置保护”</strong>：您描述的整个机制在业内称为FRP。即使刷机绕过Bootloader锁，手机重启后也会触发FRP，要求输入原机主的Google或三星等账户的账号密码，否则无法进入系统。</li><li><strong>“硬解”的风险</strong>：有技术团队通过更换手机主板等硬件来破解，但成本极高，且会使手机失去官方保修，变成“组装机”，价值大打折扣。这本身就是一种强大的威慑。</li></ul></li><li><strong>关于“报警”</strong>：<ul><li><strong>必须报案</strong>：只要您能提供准确的定位信息（例如具体到某栋楼、某房间）和IMEI号，警方是有依据出警处理的。模糊的定位（如整个小区）可能会被要求自行寻找。</li><li><strong>证据链</strong>：您通过云服务进行的每一步操作（定位、锁定、播放铃声）都是电子证据，可以截图保存，提供给警方。</li></ul></li><li><strong>新增：警惕钓鱼骗局</strong><ul><li>这是非常重要的一点！小偷可能会通过技术手段向你发送假的“查找”通知，或者冒充官方客服发短信&#x2F;邮件，索要你的Apple ID、Google或三星等账户的账号密码。<strong>请务必记住：苹果、谷歌等官方绝不会主动向你索要密码！</strong> 任何要求你输入账号密码的链接都不要点，一定要手动输入官网地址登录。</li></ul></li></ol><h4 id="总结：给失主的行动清单"><a href="#总结：给失主的行动清单" class="headerlink" title="总结：给失主的行动清单"></a><strong>总结：给失主的行动清单</strong></h4><ol><li><strong>预防</strong>：开查找、设密码、锁SIM卡、记IMEI。</li><li><strong>事发</strong>：借设备、登云服务、开丢失模式、留联系方式。</li><li><strong>追踪</strong>：根据定位，播放铃声精确定位。</li><li><strong>求助</strong>：携带定位截图和IMEI号，报警处理。</li><li><strong>止损</strong>：若确定无法找回，远程擦除数据，并第一时间联系运营商挂失&#x2F;补办SIM卡。</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;手机开启“丢失模式”后的主要安全功能和注意事项，旨在保护失主隐私、协助定位设备，并增加小偷的处理难度。&lt;/p&gt;</summary>
    
    
    
    <category term="生活" scheme="https://xuehuayu.cn/categories/%E7%94%9F%E6%B4%BB/"/>
    
    <category term="手机" scheme="https://xuehuayu.cn/categories/%E7%94%9F%E6%B4%BB/%E6%89%8B%E6%9C%BA/"/>
    
    
    <category term="手机" scheme="https://xuehuayu.cn/tags/%E6%89%8B%E6%9C%BA/"/>
    
    <category term="防盗" scheme="https://xuehuayu.cn/tags/%E9%98%B2%E7%9B%97/"/>
    
    <category term="丢失" scheme="https://xuehuayu.cn/tags/%E4%B8%A2%E5%A4%B1/"/>
    
    <category term="找回" scheme="https://xuehuayu.cn/tags/%E6%89%BE%E5%9B%9E/"/>
    
    <category term="指南" scheme="https://xuehuayu.cn/tags/%E6%8C%87%E5%8D%97/"/>
    
  </entry>
  
  <entry>
    <title>vue3 pinia在App.vue中使用了useStore报错getActivePinia() was called but there wa no active pinia</title>
    <link href="https://xuehuayu.cn/article/ead1a366.html"/>
    <id>https://xuehuayu.cn/article/ead1a366.html</id>
    <published>2025-10-29T23:04:20.000Z</published>
    <updated>2025-12-04T09:10:12.208Z</updated>
    
    <content type="html"><![CDATA[<p>vue3 pinia在App.vue中使用了useStore 报错getActivePinia() was called but there wa no active pinia</p><span id="more"></span><h3 id="事件起因"><a href="#事件起因" class="headerlink" title="事件起因"></a>事件起因</h3><p>因为要在全局<code>axios</code>中使用全局的参数，所以要在封装<code>axios</code>方法中使用<code>pinia</code>的<code>useStore</code>，因为是<code>axios</code>是<code>js/ts</code>文件在<code>import</code>时会立即执行，导致组件尚未加载<code>pinia</code>而提前使用了<code>pinia</code>，所以会报错<code>getActivePinia() was called but there wa no active pinia</code></p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>在<code>App.vue</code>中使用动态组件，通过判断<code>pinia</code>是否已经创建完成，如果未创建完成则等待<code>pinia</code>创建完成再加载组件。</p><p>App.vue文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; defineAsyncComponent, getcurrentInstance &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const index = ref(null)</span><br><span class="line">const app = getcurrentInstance()</span><br><span class="line"></span><br><span class="line">const timer = setinterval(() =&gt; &#123;</span><br><span class="line">  if (app?.appContext.config.globalProperties.$pinia) &#123;</span><br><span class="line">    index.value = defineAsyncComponent(() =&gt; import(&#x27;./views/index.vue&#x27;))</span><br><span class="line">    clearInterval(timer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;#app&quot; ref=&quot;app&quot;&gt;</span><br><span class="line">    &lt;component :is=&quot;index&quot;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;vue3 pinia在App.vue中使用了useStore 报错getActivePinia() was called but there wa no active pinia&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="Vue3" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/Vue3/"/>
    
    
    <category term="Vue3" scheme="https://xuehuayu.cn/tags/Vue3/"/>
    
    <category term="ts" scheme="https://xuehuayu.cn/tags/ts/"/>
    
    <category term="Pinia" scheme="https://xuehuayu.cn/tags/Pinia/"/>
    
  </entry>
  
  <entry>
    <title>vue3中的mixin写法使用Composition API 来实现代码复用</title>
    <link href="https://xuehuayu.cn/article/abe47f31.html"/>
    <id>https://xuehuayu.cn/article/abe47f31.html</id>
    <published>2025-10-29T11:23:40.000Z</published>
    <updated>2025-12-04T09:10:12.210Z</updated>
    
    <content type="html"><![CDATA[<p>在 Vue 3 中，虽然依然支持 <strong>Options API 风格的 Mixins</strong>，但更推荐使用 <strong>Composition API</strong> 来实现代码复用，因为它能更好地解决传统 Mixins 在可读性、命名冲突和类型推断方面的一些痛点。</p><p>下面的表格能帮你快速了解这两种方式的主要区别：</p><table><thead><tr><th align="left">特性维度</th><th align="left">Mixins (Options API 风格)</th><th align="left">Composition API (组合式函数)</th></tr></thead><tbody><tr><td align="left"><strong>代码复用方式</strong></td><td align="left">通过选项（<code>data</code>, <code>methods</code> 等）合并</td><td align="left">通过函数调用和返回值</td></tr><tr><td align="left"><strong>可读性</strong></td><td align="left">逻辑分散 across 多个选项，来源不清晰</td><td align="left">逻辑集中，按功能组织</td></tr><tr><td align="left"><strong>命名冲突</strong></td><td align="left">容易发生，需小心处理合并策略</td><td align="left">通过解构重命名，冲突风险低</td></tr><tr><td align="left"><strong>类型支持</strong></td><td align="left">较弱</td><td align="left">对 TypeScript 支持良好</td></tr><tr><td align="left"><strong>灵活性</strong></td><td align="left">相对固定</td><td align="left">高，可以像普通函数一样组合和嵌套</td></tr></tbody></table><h3 id="🍰-传统-Mixins-的写法"><a href="#🍰-传统-Mixins-的写法" class="headerlink" title="🍰 传统 Mixins 的写法"></a>🍰 传统 Mixins 的写法</h3><p>这种方式是将组件的公共逻辑通过选项的形式定义在一个对象中。</p><ol><li><p><strong>定义 Mixin</strong><br> 创建一个独立的文件（例如 <code>useCounterMixin.js</code>），使用 Options API 的风格定义数据和方法：</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useCounterMixin.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterMixin = &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">mixinCount</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">mixinIncrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">mixinCount</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Mixin mounted!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>在组件中使用</strong><br> 在组件中通过 <code>mixins</code> 选项引入，Vue 会自动合并这些选项。当组件和 Mixin 有<strong>同名属性或方法</strong>时，默认情况下，<strong>组件的选项会覆盖 Mixin 的</strong>。对于<strong>生命周期钩子</strong>，<strong>两者都会被执行，且 Mixin 的钩子先于组件自身的钩子执行</strong>。</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Count from mixin: &#123;&#123; mixinCount &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;mixinIncrement&quot;&gt;Increment from Mixin&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; useCounterMixin &#125; from &#x27;./useCounterMixin&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  mixins: [useCounterMixin],</span><br><span class="line">  // 组件自己的 data、methods 等选项...</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    console.log(&#x27;Component mounted!&#x27;);</span><br><span class="line">    // 输出顺序：</span><br><span class="line">    // &quot;Mixin mounted!&quot;</span><br><span class="line">    // &quot;Component mounted!&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="💡-使用-Composition-API-实现逻辑复用"><a href="#💡-使用-Composition-API-实现逻辑复用" class="headerlink" title="💡 使用 Composition API 实现逻辑复用"></a>💡 使用 Composition API 实现逻辑复用</h3><p>Composition API 通过“组合式函数”来实现复用，这是一个更符合 JavaScript 原生思维的方式。</p><ol><li><p><strong>创建组合式函数</strong><br> 创建一个函数（通常以 <code>use</code> 开头），在函数内部使用 <code>ref</code>, <code>reactive</code>, <code>computed</code> 等 Composition API 定义响应式数据和逻辑，并返回需要暴露给组件的值。</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useCounter.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useCounter</span>(<span class="params">initialValue = <span class="number">0</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 响应式状态</span></span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(initialValue)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 计算属性</span></span><br><span class="line">  <span class="keyword">const</span> double = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方法</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    count.<span class="property">value</span>++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生命周期钩子</span></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Counter composition mounted!&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回所有需要使用的数据和方法</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    count,</span><br><span class="line">    double,</span><br><span class="line">    increment</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>在组件中使用组合式函数</strong><br> 在组件的 <code>setup()</code> 函数或 <code>&lt;script setup&gt;</code> 语法糖中，调用组合式函数并获取其返回的值。你可以按需重命名，有效避免了命名冲突。</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用 &lt;script setup&gt; 语法 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Count: &#123;&#123; count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Double: &#123;&#123; double &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;Increment&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">// 导入组合式函数</span><br><span class="line">import &#123; useCounter &#125; from &#x27;./useCounter&#x27;</span><br><span class="line"></span><br><span class="line">// 调用函数，解构返回值</span><br><span class="line">const &#123; count, double, increment &#125; = useCounter(10) // 可以传递初始参数</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="✅-如何选择与最佳实践"><a href="#✅-如何选择与最佳实践" class="headerlink" title="✅ 如何选择与最佳实践"></a>✅ 如何选择与最佳实践</h3><ul><li><p><strong>选择建议</strong>：</p><ul><li>对于新项目或复杂的逻辑复用，<strong>强烈推荐使用 Composition API</strong>。它带来了更好的可维护性和类型支持。</li><li>如果你是在维护一个旧的、主要使用 Options API 的 Vue 2 项目，或者复用的逻辑非常简单，可以继续使用 Mixins。</li></ul></li><li><p><strong>最佳实践</strong>：</p><ul><li><strong>单一职责</strong>：无论是 Mixin 还是组合式函数，都尽量让其只负责一个明确的功能。</li><li><strong>清晰命名</strong>：在 Mixin 中，可以考虑使用特定的前缀来减少命名冲突的风险（例如 <code>mixinCount</code>）。在组合式函数中，则可以利用解构重命名。</li><li><strong>明确依赖</strong>：在组合式函数中，对于需要从外部接收的参数，使用 <code>ref</code> 或 <code>reactive</code> 保持其响应性。</li></ul></li></ul><p>总而言之，Composition API 通过原生 JavaScript 的函数机制进行逻辑组合和复用，提供了比 Mixins 更灵活和可控的方式，是现代 Vue 应用代码复用的首选。</p><p>希望这份讲解能帮助你顺利地在 Vue 3 中实现代码复用。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在 Vue 3 中，虽然依然支持 &lt;strong&gt;Options API 风格的 Mixins&lt;/strong&gt;，但更推荐使用 &lt;strong&gt;Composition API&lt;/strong&gt; 来实现代码复用，因为它能更好地解决传统 Mixins 在可读性、命名冲突和类型推</summary>
      
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="Vue3" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/Vue3/"/>
    
    
    <category term="Vue3" scheme="https://xuehuayu.cn/tags/Vue3/"/>
    
    <category term="Composition" scheme="https://xuehuayu.cn/tags/Composition/"/>
    
    <category term="Mixins" scheme="https://xuehuayu.cn/tags/Mixins/"/>
    
    <category term="setup" scheme="https://xuehuayu.cn/tags/setup/"/>
    
    <category term="Options" scheme="https://xuehuayu.cn/tags/Options/"/>
    
  </entry>
  
  <entry>
    <title>windows虚拟内存自动管理好还是手动设置好？ 如果是手动设置多少合适？</title>
    <link href="https://xuehuayu.cn/article/cbf3079f.html"/>
    <id>https://xuehuayu.cn/article/cbf3079f.html</id>
    <published>2025-10-29T08:41:30.000Z</published>
    <updated>2025-12-04T09:10:12.211Z</updated>
    
    <content type="html"><![CDATA[<p>对于Windows虚拟内存的设置，<strong>绝大多数普通用户选择“自动管理”是更省心且稳妥的方案</strong>。不过，如果你有非常特定的使用需求，手动设置也能作为优化手段。</p><span id="more"></span><p>为了帮你快速了解两种方式的区别，我准备了下面的表格：</p><table><thead><tr><th align="left">对比维度</th><th align="left">⚙️ 自动管理</th><th align="left">🛠️ 手动设置</th></tr></thead><tbody><tr><td align="left"><strong>工作原理</strong></td><td align="left">系统根据当前负载动态调整虚拟内存大小。</td><td align="left">由你固定初始和最大值，系统不会自动改变。</td></tr><tr><td align="left"><strong>优点</strong></td><td align="left">✅ <strong>简单方便</strong>，无需用户干预<br>✅ <strong>动态适配</strong>，应对不同使用场景<br>✅ <strong>稳定可靠</strong>，微软官方推荐</td><td align="left">✅ <strong>性能稳定</strong>，避免系统频繁调整产生碎片（若设置固定值）<br>✅ <strong>应对特殊需求</strong>，可为特定任务预留足够空间</td></tr><tr><td align="left"><strong>缺点</strong></td><td align="left">❌ 可能不够精确，动态调整偶尔会产生磁盘碎片</td><td align="left">❌ <strong>设置不当有风险</strong>：过小易内存不足，过大会占用磁盘空间且可能因频繁读写拖慢系统</td></tr><tr><td align="left"><strong>适用人群</strong></td><td align="left">绝大多数普通用户、游戏玩家、日常办公者。</td><td align="left">高级用户、专业软件使用者（如运行大型建模、视频编辑），或曾遇到“虚拟内存不足”提示的用户。</td></tr></tbody></table><h3 id="💡-如何选择与手动设置建议"><a href="#💡-如何选择与手动设置建议" class="headerlink" title="💡 如何选择与手动设置建议"></a>💡 如何选择与手动设置建议</h3><p>你可以参考以下流程图，快速判断哪种方式更适合你：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[开始选择虚拟内存方案] --&gt; B&#123;你是大多数普通用户吗？&#125;;</span><br><span class="line">    B -- 是 --&gt; C[强烈推荐使用&lt;br&gt;**自动管理**];</span><br><span class="line">    B -- 否&lt;br&gt;（有特殊需求或问题） --&gt; D&#123;是否常遇到&lt;br&gt;虚拟内存不足警告？&#125;;</span><br><span class="line"></span><br><span class="line">    D -- 是 --&gt; E[建议手动设置];</span><br><span class="line">    E --&gt; F[按推荐值的1.5-3倍&lt;br&gt;适当调大虚拟内存];</span><br><span class="line"></span><br><span class="line">    D -- 否 --&gt; G&#123;是否追求专业软件&lt;br&gt;或游戏的极致稳定？&#125;;</span><br><span class="line">    G -- 是 --&gt; H[建议手动设置固定值];</span><br><span class="line">    H --&gt; I[参考推荐值&lt;br&gt;设置为固定大小];</span><br><span class="line"></span><br><span class="line">    G -- 否 --&gt; C;</span><br><span class="line"></span><br><span class="line">    E &amp; H --&gt; J[**手动设置通用建议**&lt;br&gt;初始大小 = 物理内存的1-1.5倍&lt;br&gt;最大值 = 物理内存的1.5-3倍];</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果经过判断，你确实需要手动设置，可以参考以下具体步骤和通用建议：</p><ol><li><p><strong>打开设置窗口</strong>：</p><ul><li>右键点击“此电脑”，选择“属性” → “高级系统设置”。</li><li>或直接按 <code>Windows徽标 + R</code> 键，输入 <code>sysdm.cpl</code> 后回车。</li></ul></li><li><p><strong>进行设置</strong>：在“系统属性”窗口中，进入“高级”选项卡，点击“性能”下的“设置” → 再进入“高级”选项卡，点击“虚拟内存”下的“更改…”。</p></li><li><p><strong>手动指定</strong>：</p><ul><li>取消勾选“<strong>自动管理所有驱动器的分页文件大小</strong>”。</li><li>选择你想要设置的驱动器（通常是C盘）。</li><li>选择“<strong>自定义大小</strong>”，分别填写“初始大小”和“最大值”。</li><li>点击“<strong>设置</strong>”按钮，然后“确定”并重启电脑使设置生效。</li></ul></li></ol><p>手动设置的通用建议：</p><ul><li><strong>初始大小</strong>：设置为物理内存的 <strong>1倍到1.5倍</strong>。</li><li><strong>最大值</strong>：设置为物理内存的 <strong>1.5倍到3倍</strong>。</li></ul><blockquote><p>注：例如对于8GB物理内存的电脑，初始大小可设为8192MB，最大值可设为12288MB至24576MB之间。如果你的物理内存更大（如16GB以上），倍数可以取推荐范围中较小的值，甚至1倍即可。</p></blockquote><h3 id="⚠️-注意事项"><a href="#⚠️-注意事项" class="headerlink" title="⚠️ 注意事项"></a>⚠️ 注意事项</h3><ul><li><p><strong>手动设置的风险</strong>：手动设置虚拟内存并非“越大越好”。如果设置得过大，系统会频繁地在物理内存和过大的虚拟内存之间进行数据交换（页面文件操作），由于硬盘速度远慢于内存，这反而会导致系统响应变慢，出现卡顿。</p></li><li><p><strong>SSD用户须知</strong>：对于使用固态硬盘（SSD）的用户，也<strong>建议启用虚拟内存</strong>。虽然SSD速度比机械硬盘快很多，但仍远低于物理内存。启用虚拟内存可以避免因内存不足导致的程序崩溃和系统不稳定。</p></li><li><p><strong>驱动器选择</strong>：建议<strong>优先将虚拟内存设置在SSD上</strong>，因为读写速度快得多。如果只有机械硬盘，可以尝试将其设置在非系统盘、且剩余空间较大的分区上。</p></li></ul><p>希望这份详细的指南能帮助你做出合适的选择。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;对于Windows虚拟内存的设置，&lt;strong&gt;绝大多数普通用户选择“自动管理”是更省心且稳妥的方案&lt;/strong&gt;。不过，如果你有非常特定的使用需求，手动设置也能作为优化手段。&lt;/p&gt;</summary>
    
    
    
    <category term="系统" scheme="https://xuehuayu.cn/categories/%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="System" scheme="https://xuehuayu.cn/categories/%E7%B3%BB%E7%BB%9F/System/"/>
    
    <category term="Windows" scheme="https://xuehuayu.cn/categories/%E7%B3%BB%E7%BB%9F/System/Windows/"/>
    
    
    <category term="Windows" scheme="https://xuehuayu.cn/tags/Windows/"/>
    
    <category term="虚拟内存" scheme="https://xuehuayu.cn/tags/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/"/>
    
    <category term="优化" scheme="https://xuehuayu.cn/tags/%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>vue3中ts提示扩张参数必须具有元组类型或传递给rest参数</title>
    <link href="https://xuehuayu.cn/article/763d6087.html"/>
    <id>https://xuehuayu.cn/article/763d6087.html</id>
    <published>2025-10-29T08:38:46.000Z</published>
    <updated>2025-12-04T09:10:12.209Z</updated>
    
    <content type="html"><![CDATA[<p>这个错误通常发生在 TypeScript 中，当你尝试使用扩展运算符（spread operator）<code>...</code> 时，TypeScript 检测到类型不匹配。</p><span id="more"></span><h2 id="错误原因"><a href="#错误原因" class="headerlink" title="错误原因"></a>错误原因</h2><p>这个错误表明你正在尝试扩展一个不是元组类型或数组类型的值。</p><h2 id="常见场景和解决方案"><a href="#常见场景和解决方案" class="headerlink" title="常见场景和解决方案"></a>常见场景和解决方案</h2><h3 id="1-函数参数扩展"><a href="#1-函数参数扩展" class="headerlink" title="1. 函数参数扩展"></a>1. 函数参数扩展</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">example</span>(<span class="params">...args: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确示例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">example</span>(<span class="params">...args: <span class="built_in">number</span>[]</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">exampleTuple</span>(<span class="params">...args: [<span class="built_in">string</span>, <span class="built_in">number</span>]</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-数组-元组合并"><a href="#2-数组-元组合并" class="headerlink" title="2. 数组&#x2F;元组合并"></a>2. 数组&#x2F;元组合并</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示例</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">tuple</span>: [<span class="built_in">number</span>, <span class="built_in">string</span>] = [<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [...tuple]; <span class="comment">// 如果 tuple 类型定义错误会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确示例</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">tuple</span>: [<span class="built_in">number</span>, <span class="built_in">string</span>] = [<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [...tuple]; <span class="comment">// 正确</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者使用数组</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">numbers</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> newArray = [...numbers];</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-对象扩展"><a href="#3-对象扩展" class="headerlink" title="3. 对象扩展"></a>3. 对象扩展</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象扩展通常不会出现这个错误</span></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; ...obj1, <span class="attr">c</span>: <span class="number">3</span> &#125;; <span class="comment">// 正确</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-React-组件-props-扩展"><a href="#4-React-组件-props-扩展" class="headerlink" title="4. React 组件 props 扩展"></a>4. React 组件 props 扩展</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React 组件示例</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">props: ButtonProps</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者使用 React 的类型</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ButtonHTMLAttributes</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">props: ButtonHTMLAttributes&lt;HTMLButtonElement&gt;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-泛型约束"><a href="#5-泛型约束" class="headerlink" title="5. 泛型约束"></a>5. 泛型约束</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用泛型约束确保可迭代</span></span><br><span class="line"><span class="keyword">function</span> mergeArrays&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt;(...<span class="attr">arrays</span>: T[]): T &#123;</span><br><span class="line">  <span class="keyword">return</span> arrays.<span class="title function_">flat</span>() <span class="keyword">as</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h2><ol><li><strong>检查类型定义</strong>：确保你扩展的值有正确的数组或元组类型</li><li><strong>使用类型断言</strong>（谨慎使用）： <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = someValue <span class="keyword">as</span> <span class="built_in">any</span>[];</span><br><span class="line"><span class="keyword">const</span> result = [...value];</span><br></pre></td></tr></table></figure></li><li><strong>检查第三方库类型</strong>：某些库可能需要安装对应的类型定义</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;这个错误通常发生在 TypeScript 中，当你尝试使用扩展运算符（spread operator）&lt;code&gt;...&lt;/code&gt; 时，TypeScript 检测到类型不匹配。&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="Vue3" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/Vue3/"/>
    
    
    <category term="Vue3" scheme="https://xuehuayu.cn/tags/Vue3/"/>
    
    <category term="ts" scheme="https://xuehuayu.cn/tags/ts/"/>
    
    <category term="Vetur" scheme="https://xuehuayu.cn/tags/Vetur/"/>
    
    <category term="Volar" scheme="https://xuehuayu.cn/tags/Volar/"/>
    
    <category term="export" scheme="https://xuehuayu.cn/tags/export/"/>
    
    <category term="spread" scheme="https://xuehuayu.cn/tags/spread/"/>
    
  </entry>
  
  <entry>
    <title>vue3 组件 has no default export</title>
    <link href="https://xuehuayu.cn/article/2f775138.html"/>
    <id>https://xuehuayu.cn/article/2f775138.html</id>
    <published>2025-10-29T08:35:35.000Z</published>
    <updated>2025-12-04T09:10:12.209Z</updated>
    
    <content type="html"><![CDATA[<p>在 Vue 3 项目中遇到 “has no default export” 的提示，通常不是因为你的代码写错了，而是由于 <strong>VSCode 的 Vue 扩展 <code>Vetur</code> 对 Vue 3 和 <code>&lt;script setup&gt;</code> 语法支持不完善</strong>导致的。</p><span id="more"></span><p>别担心，这里有几个解决方法，你可以根据情况尝试。</p><h3 id="推荐的解决方案-🥇"><a href="#推荐的解决方案-🥇" class="headerlink" title="推荐的解决方案 🥇"></a>推荐的解决方案 🥇</h3><p>最彻底和推荐的方法是<strong>更换 VSCode 插件</strong>。</p><ol><li><strong>禁用或卸载 <code>Vetur</code></strong>：在 VSCode 的扩展面板中，找到 Vetur 并将其禁用或直接卸载。</li><li><strong>安装 <code>Volar</code></strong>：在 VSCode 扩展商店中搜索并安装 <code>Vue Language Features (Volar)</code>。这是 Vue 官方团队推荐的新一代 Vue 工具插件，完美支持 Vue 3、TypeScript 和 <code>&lt;script setup&gt;</code> 语法。</li><li><strong>重启 VSCode</strong>：完成上述操作后，重启 VSCode，错误提示应该就会消失。</li></ol><blockquote><p>注：如果你在使用 TypeScript，建议同时安装 <code>TypeScript Vue Plugin</code> 插件，它可以更好地支持在 <code>.ts</code> 文件中导入 <code>.vue</code> 组件。</p></blockquote><h3 id="其他备选方案"><a href="#其他备选方案" class="headerlink" title="其他备选方案"></a>其他备选方案</h3><p>如果上述方法不适用，你可以考虑以下选择：</p><ul><li><p><strong>临时配置 Vetur</strong>：如果暂时不想卸载 Vetur，可以在 VSCode 的设置中（<code>settings.json</code>）添加以下配置来关闭 Vetur 的脚本验证：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;vetur.validation.script&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br></pre></td></tr></table></figure><blockquote><p>注意：这只是消除了错误提示，并未从根本上解决问题。</p></blockquote></li><li><p><strong>检查模块导出类型（针对JS&#x2F;TS库）</strong>：如果你在导入一个非 Vue 组件的 JavaScript&#x2F;TypeScript 库时遇到类似错误（例如 <code>&quot;default&quot; is not exported by ...</code>），这表示该库可能没有使用 <code>export default</code> 语法。这时，你需要根据该库提供的导出方式，使用<strong>命名导入</strong>而非默认导入。</p><p><strong>默认导入</strong>（可能导致错误）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> myLib <span class="keyword">from</span> <span class="string">&#x27;my-library&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>命名导入</strong>（可能为正确方式）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; myFunction &#125; <span class="keyword">from</span> <span class="string">&#x27;my-library&#x27;</span>;</span><br></pre></td></tr></table></figure><p>具体应使用哪种方式，请查阅该库的官方文档。</p></li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>大多数情况下，”has no default export” 的提示通过 <strong>用 Volar 替换 Vetur 即可解决</strong>。这个方案也是 Vue 作者尤雨溪所推荐的。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在 Vue 3 项目中遇到 “has no default export” 的提示，通常不是因为你的代码写错了，而是由于 &lt;strong&gt;VSCode 的 Vue 扩展 &lt;code&gt;Vetur&lt;/code&gt; 对 Vue 3 和 &lt;code&gt;&amp;lt;script setup&amp;gt;&lt;/code&gt; 语法支持不完善&lt;/strong&gt;导致的。&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="Vue3" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/Vue3/"/>
    
    
    <category term="Vue3" scheme="https://xuehuayu.cn/tags/Vue3/"/>
    
    <category term="ts" scheme="https://xuehuayu.cn/tags/ts/"/>
    
    <category term="Vetur" scheme="https://xuehuayu.cn/tags/Vetur/"/>
    
    <category term="Volar" scheme="https://xuehuayu.cn/tags/Volar/"/>
    
    <category term="export" scheme="https://xuehuayu.cn/tags/export/"/>
    
  </entry>
  
  <entry>
    <title>js es6 class 类中的值是异步赋值， 子类中如何获取这个值？</title>
    <link href="https://xuehuayu.cn/article/37e1f99c.html"/>
    <id>https://xuehuayu.cn/article/37e1f99c.html</id>
    <published>2025-10-29T08:32:57.000Z</published>
    <updated>2025-12-04T09:10:12.207Z</updated>
    
    <content type="html"><![CDATA[<p>在 ES6 类中，如果父类的属性是通过<strong>异步赋值</strong>的，子类能否获取到这个值取决于<strong>访问时机</strong>。下面通过代码示例详细说明：</p><span id="more"></span><h2 id="1-同步-vs-异步赋值的区别"><a href="#1-同步-vs-异步赋值的区别" class="headerlink" title="1. 同步 vs 异步赋值的区别"></a>1. 同步 vs 异步赋值的区别</h2><h3 id="同步赋值（正常情况）"><a href="#同步赋值（正常情况）" class="headerlink" title="同步赋值（正常情况）"></a>同步赋值（正常情况）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">syncValue</span> = <span class="string">&#x27;同步值&#x27;</span>; <span class="comment">// 同步赋值</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">getValues</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">syncValue</span>: <span class="variable language_">this</span>.<span class="property">syncValue</span> <span class="comment">// 可以正常获取</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(child.<span class="title function_">getValues</span>()); <span class="comment">// &#123; syncValue: &#x27;同步值&#x27; &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="异步赋值的情况"><a href="#异步赋值的情况" class="headerlink" title="异步赋值的情况"></a>异步赋值的情况</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">asyncValue</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 异步赋值</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">asyncValue</span> = <span class="string">&#x27;异步赋值完成&#x27;</span>;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">getValues</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">asyncValue</span>: <span class="variable language_">this</span>.<span class="property">asyncValue</span> <span class="comment">// ❌ 立即访问可能为 null</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(child.<span class="title function_">getValues</span>()); <span class="comment">// &#123; asyncValue: null &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1秒后再访问</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(child.<span class="title function_">getValues</span>()); <span class="comment">// &#123; asyncValue: &#x27;异步赋值完成&#x27; &#125;</span></span><br><span class="line">&#125;, <span class="number">1500</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-解决方案"><a href="#2-解决方案" class="headerlink" title="2. 解决方案"></a>2. 解决方案</h2><h3 id="方案-1：使用-Promise-管理异步状态"><a href="#方案-1：使用-Promise-管理异步状态" class="headerlink" title="方案 1：使用 Promise 管理异步状态"></a>方案 1：使用 Promise 管理异步状态</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">asyncValue</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">valueReady</span> = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">asyncValue</span> = <span class="string">&#x27;异步赋值完成&#x27;</span>;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">asyncValue</span>);</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getValues</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 等待异步赋值完成</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">valueReady</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">asyncValue</span>: <span class="variable language_">this</span>.<span class="property">asyncValue</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> child = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">child.<span class="title function_">getValues</span>().<span class="title function_">then</span>(<span class="function"><span class="params">values</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(values); <span class="comment">// &#123; asyncValue: &#x27;异步赋值完成&#x27; &#125;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方案-2：使用-async-await-模式"><a href="#方案-2：使用-async-await-模式" class="headerlink" title="方案 2：使用 async&#x2F;await 模式"></a>方案 2：使用 async&#x2F;await 模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialized</span> = <span class="variable language_">this</span>.<span class="title function_">init</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 模拟异步操作</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">asyncValue</span> = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&#x27;异步值&#x27;</span>), <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">ensureInitialized</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">initialized</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getAsyncValue</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">ensureInitialized</span>(); <span class="comment">// 等待父类初始化完成</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">asyncValue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> child = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">child.<span class="title function_">getAsyncValue</span>().<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value); <span class="comment">// &#x27;异步值&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方案-3：事件驱动模式"><a href="#方案-3：事件驱动模式" class="headerlink" title="方案 3：事件驱动模式"></a>方案 3：事件驱动模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">asyncValue</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">asyncValue</span> = <span class="string">&#x27;异步值&#x27;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">asyncValue</span>));</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onValueReady</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">asyncValue</span>) &#123;</span><br><span class="line">      <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">asyncValue</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">push</span>(callback);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">getValue</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onValueReady</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">callback</span>(value);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> child = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">child.<span class="title function_">getValue</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value); <span class="comment">// &#x27;异步值&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-实际应用场景"><a href="#3-实际应用场景" class="headerlink" title="3. 实际应用场景"></a>3. 实际应用场景</h2><h3 id="异步数据获取"><a href="#异步数据获取" class="headerlink" title="异步数据获取"></a>异步数据获取</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userData</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialized</span> = <span class="variable language_">this</span>.<span class="title function_">fetchUserData</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetchUserData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 模拟 API 调用</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userData</span> = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/user&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">ensureReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">initialized</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">ApiService</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getUserProfile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">ensureReady</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="variable language_">this</span>.<span class="property">userData</span>.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">email</span>: <span class="variable language_">this</span>.<span class="property">userData</span>.<span class="property">email</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><strong>子类可以获取父类的异步赋值</strong>，但必须在<strong>异步操作完成后</strong></li><li>立即访问可能得到 <code>null</code> 或初始值</li><li>推荐使用 <strong>Promise</strong> 或 <strong>async&#x2F;await</strong> 来管理异步状态</li><li>通过等待初始化完成的方法确保数据可用性</li><li>事件监听模式适合需要实时响应的场景</li></ul><p>关键在于<strong>时序控制</strong> - 确保在访问异步值之前，相关的异步操作已经完成。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在 ES6 类中，如果父类的属性是通过&lt;strong&gt;异步赋值&lt;/strong&gt;的，子类能否获取到这个值取决于&lt;strong&gt;访问时机&lt;/strong&gt;。下面通过代码示例详细说明：&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="Class" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/Class/"/>
    
    
    <category term="Class" scheme="https://xuehuayu.cn/tags/Class/"/>
    
    <category term="父类" scheme="https://xuehuayu.cn/tags/%E7%88%B6%E7%B1%BB/"/>
    
    <category term="子类" scheme="https://xuehuayu.cn/tags/%E5%AD%90%E7%B1%BB/"/>
    
    <category term="异步" scheme="https://xuehuayu.cn/tags/%E5%BC%82%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>三岁孩子不给看电视就不吃饭怎么办</title>
    <link href="https://xuehuayu.cn/article/332cad3d.html"/>
    <id>https://xuehuayu.cn/article/332cad3d.html</id>
    <published>2025-10-27T10:45:32.000Z</published>
    <updated>2025-12-04T09:10:12.206Z</updated>
    
    <content type="html"><![CDATA[<p>这是一个非常常见且让很多家长头疼的问题。三岁的孩子正处于自主意识萌发的阶段，用不吃饭来“要挟”看电视，或者因为习惯了电视伴饭而失去自主进食的兴趣，都是典型的表现。</p><span id="more"></span><p>首先，请理解并坚定一个核心原则：<strong>吃饭和看电视是两件独立的事情，不应该被捆绑在一起。</strong> 用看电视换来的一时安静吃饭，长远来看会带来更多问题，如消化不良、注意力不集中、自主进食能力缺失等。</p><p>以下是针对“不看电视不吃饭”这个问题的详细解决步骤和策略，请您耐心并坚持执行：</p><h3 id="第一步：立即行动——建立清晰的规则"><a href="#第一步：立即行动——建立清晰的规则" class="headerlink" title="第一步：立即行动——建立清晰的规则"></a>第一步：立即行动——建立清晰的规则</h3><ol><li><strong>全家统一立场，坚决执行</strong>：所有家庭成员（包括爷爷奶奶&#x2F;外公外婆）必须达成一致，从今天起，吃饭时间绝不开电视。这是成功的关键。</li><li><strong>温和而坚定地告知孩子</strong>：用简单直接的语言告诉孩子新规则。“宝宝，从今天开始，我们吃饭的时候要关掉电视了。吃完饭，我们再看一会儿。” 无论他如何哭闹，都要保持平静，重复规则。</li><li><strong>做好心理准备，接受暂时的“饥饿”</strong>：在改变初期，孩子很可能会因为愿望未被满足而拒绝吃饭。这是最考验家长的时刻。请相信，<strong>一两顿吃不饱，不会影响孩子的健康</strong>，但这是他学习规则必须经历的过程。他会明白，哭闹无法改变规则。</li></ol><h3 id="第二步：长期策略——让吃饭变得有吸引力"><a href="#第二步：长期策略——让吃饭变得有吸引力" class="headerlink" title="第二步：长期策略——让吃饭变得有吸引力"></a>第二步：长期策略——让吃饭变得有吸引力</h3><p>当拿走了“电视”这个外部刺激后，我们需要让“吃饭”本身变得有趣，重新激发孩子内在的进食欲望。</p><ol><li><p><strong>让孩子参与过程</strong>：</p><ul><li><strong>一起准备食材</strong>：带他一起去买菜，让他挑选喜欢的蔬菜（比如“我们今天买这个红色的番茄还是绿色的黄瓜？”）。</li><li><strong>简单参与烹饪</strong>：让他洗菜、递东西、摆碗筷。他会对自己参与制作的食物更有兴趣。</li><li><strong>赋予选择权</strong>：提供有限的健康选择，比如“你想用小狗碗还是小熊碗吃饭？”“你想先吃胡萝卜还是西兰花？”这能满足他的自主感。</li></ul></li><li><p><strong>打造愉快的进餐氛围</strong>：</p><ul><li><strong>固定时间和地点</strong>：在餐桌上吃饭，形成仪式感。全家尽量一起吃饭，创造轻松聊天的氛围，而不是只盯着孩子。</li><li><strong>让食物变得有趣</strong>：把食物做成可爱的造型，比如饭团做成小熊、胡萝卜切成星星。使用色彩鲜艳的餐盘。</li><li><strong>正面描述食物</strong>：用生动的语言描述食物，“这个土豆泥像不像云朵？”“听，咬黄瓜的声音多清脆！” 避免说“这个有营养，快吃”这种说教语言。</li></ul></li><li><p><strong>管理零食和奶量</strong>：</p><ul><li>严格控制正餐之间的零食，尤其是饭前1-2小时内不要给任何零食、果汁或牛奶。</li><li>确保奶是辅食，而不是主食。三岁孩子每日奶量建议在360-480ml左右，过多会影响正餐食欲。</li></ul></li></ol><h3 id="第三步：应对哭闹和拒食的“战术”"><a href="#第三步：应对哭闹和拒食的“战术”" class="headerlink" title="第三步：应对哭闹和拒食的“战术”"></a>第三步：应对哭闹和拒食的“战术”</h3><p>当规则建立初期，孩子哭闹时，你可以这样做：</p><ol><li><p><strong>共情，但不妥协</strong>：“妈妈知道你想看电视，不能看电视让你很难过。我们可以先吃完饭，再一起看一集你最喜欢的动画片。” 承认他的情绪，但坚持原则。</p></li><li><p><strong>设定“饭后节目”</strong>：承诺饭后可以有短暂的亲子活动，比如看15分钟电视、读一本绘本或玩一个游戏。这给了他一个期待，并且让他知道“吃饭”是进行下一件有趣事情的必经步骤。</p></li><li><p><strong>“不催促、不强迫、不贿赂”</strong>：</p><ul><li><strong>不催促</strong>：规定一个合理的进餐时间（比如30分钟），时间到了就平静地收走饭菜。</li><li><strong>不强迫</strong>：不要追着喂，也不要因为他不吃就生气打骂。把吃饭的责任还给孩子。</li><li><strong>不贿赂</strong>：避免说“你吃完这口，我就给你糖吃”。这会让吃饭变成一场交易。</li></ul></li><li><p><strong>利用“同伴效应”</strong>：</p><ul><li>如果有可能，多邀请小朋友来家里一起吃饭，孩子们在一起吃饭会更有竞争和模仿的乐趣。</li><li>家长自己要做出吃得津津有味的样子。</li></ul></li></ol><h3 id="总结与提醒"><a href="#总结与提醒" class="headerlink" title="总结与提醒"></a>总结与提醒</h3><ul><li><strong>一致性是关键</strong>：今天不让看，明天心软又让看，规则就彻底失效了，下次纠正会更难。</li><li><strong>耐心，耐心，再耐心</strong>：改变一个习惯需要时间，可能是几天，也可能是一两周。请给您的孩子和自己足够的时间来适应。</li><li><strong>相信孩子的本能</strong>：健康的孩子不会让自己长期挨饿。当他发现哭闹无用，且饭桌上的食物越来越有趣时，他会重新开始吃饭。</li></ul><p>这个过程对家长来说是巨大的考验，但为了孩子养成终身受益的良好饮食习惯，前期的辛苦是完全值得的。当孩子最终能坐在餐桌上，专注于食物本身，并享受和家人共度的时光时，您会感谢现在坚定的自己。</p><p><strong>如果孩子长期食欲不振，且伴有生长发育迟缓、精神萎靡等症状，建议咨询儿科医生，排除生理性病变的可能。</strong></p><p>希望这些信息能帮助您。如果还有其他想了解的，随时可以留言。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;这是一个非常常见且让很多家长头疼的问题。三岁的孩子正处于自主意识萌发的阶段，用不吃饭来“要挟”看电视，或者因为习惯了电视伴饭而失去自主进食的兴趣，都是典型的表现。&lt;/p&gt;</summary>
    
    
    
    <category term="儿童" scheme="https://xuehuayu.cn/categories/%E5%84%BF%E7%AB%A5/"/>
    
    <category term="健康" scheme="https://xuehuayu.cn/categories/%E5%84%BF%E7%AB%A5/%E5%81%A5%E5%BA%B7/"/>
    
    <category term="Children" scheme="https://xuehuayu.cn/categories/%E5%84%BF%E7%AB%A5/%E5%81%A5%E5%BA%B7/Children/"/>
    
    <category term="Health" scheme="https://xuehuayu.cn/categories/%E5%84%BF%E7%AB%A5/%E5%81%A5%E5%BA%B7/Children/Health/"/>
    
    
    <category term="儿童" scheme="https://xuehuayu.cn/tags/%E5%84%BF%E7%AB%A5/"/>
    
    <category term="三岁" scheme="https://xuehuayu.cn/tags/%E4%B8%89%E5%B2%81/"/>
    
    <category term="看电视" scheme="https://xuehuayu.cn/tags/%E7%9C%8B%E7%94%B5%E8%A7%86/"/>
    
    <category term="不吃饭" scheme="https://xuehuayu.cn/tags/%E4%B8%8D%E5%90%83%E9%A5%AD/"/>
    
  </entry>
  
  <entry>
    <title>js中Map和对象{}的区别</title>
    <link href="https://xuehuayu.cn/article/80fad23d.html"/>
    <id>https://xuehuayu.cn/article/80fad23d.html</id>
    <published>2025-10-24T18:21:54.000Z</published>
    <updated>2025-12-04T09:10:12.205Z</updated>
    
    <content type="html"><![CDATA[<p>在 JavaScript 中，<code>new Map</code> 和普通对象 <code>{}</code> 都是键值对集合，但它们有重要区别：</p><span id="more"></span><h2 id="1-键的类型"><a href="#1-键的类型" class="headerlink" title="1. 键的类型"></a>1. 键的类型</h2><h3 id="Map-键可以是任意类型"><a href="#Map-键可以是任意类型" class="headerlink" title="Map - 键可以是任意类型"></a>Map - 键可以是任意类型</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 各种类型的键都可以</span></span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;字符串键&#x27;</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="number">123</span>, <span class="string">&#x27;数字键&#x27;</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="literal">true</span>, <span class="string">&#x27;布尔键&#x27;</span>);</span><br><span class="line">map.<span class="title function_">set</span>(&#123;&#125;, <span class="string">&#x27;对象键&#x27;</span>);</span><br><span class="line">map.<span class="title function_">set</span>([], <span class="string">&#x27;数组键&#x27;</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;, <span class="string">&#x27;函数键&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(<span class="number">123</span>)); <span class="comment">// &#x27;数字键&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象-键只能是字符串或-Symbol"><a href="#对象-键只能是字符串或-Symbol" class="headerlink" title="对象 - 键只能是字符串或 Symbol"></a>对象 - 键只能是字符串或 Symbol</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj[<span class="string">&#x27;string&#x27;</span>] = <span class="string">&#x27;字符串键&#x27;</span>; <span class="comment">// ✅</span></span><br><span class="line">obj[<span class="number">123</span>] = <span class="string">&#x27;数字键&#x27;</span>; <span class="comment">// 会被转换为字符串 &quot;123&quot;</span></span><br><span class="line">obj[&#123;&#125;] = <span class="string">&#x27;对象键&#x27;</span>; <span class="comment">// 键会被转换为 &quot;[object Object]&quot;</span></span><br><span class="line">obj[[<span class="number">1</span>,<span class="number">2</span>]] = <span class="string">&#x27;数组键&#x27;</span>; <span class="comment">// 键会被转换为 &quot;1,2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj);</span><br><span class="line"><span class="comment">// &#123; &quot;123&quot;: &quot;数字键&quot;, &quot;string&quot;: &quot;字符串键&quot;, &quot;[object Object]&quot;: &quot;对象键&quot;, &quot;1,2&quot;: &quot;数组键&quot; &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-顺序保证"><a href="#2-顺序保证" class="headerlink" title="2. 顺序保证"></a>2. 顺序保证</h2><h3 id="Map-保持插入顺序"><a href="#Map-保持插入顺序" class="headerlink" title="Map - 保持插入顺序"></a>Map - 保持插入顺序</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;z&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;m&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历时保持插入顺序</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// z, a, m (插入顺序)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象-不保证顺序（现代JS有改进但仍有差异）"><a href="#对象-不保证顺序（现代JS有改进但仍有差异）" class="headerlink" title="对象 - 不保证顺序（现代JS有改进但仍有差异）"></a>对象 - 不保证顺序（现代JS有改进但仍有差异）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">z</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">m</span>: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现代JS中字符串键通常按创建顺序，但有特殊情况</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// 顺序可能因JS引擎而异</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-大小获取"><a href="#3-大小获取" class="headerlink" title="3. 大小获取"></a>3. 大小获取</h2><h3 id="Map-有-size-属性"><a href="#Map-有-size-属性" class="headerlink" title="Map - 有 size 属性"></a>Map - 有 size 属性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="property">size</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象-需要手动计算"><a href="#对象-需要手动计算" class="headerlink" title="对象 - 需要手动计算"></a>对象 - 需要手动计算</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="property">length</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-性能差异"><a href="#4-性能差异" class="headerlink" title="4. 性能差异"></a>4. 性能差异</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map 在频繁增删时性能更好</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加大量数据测试</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&#x27;Map添加&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">    map.<span class="title function_">set</span>(i, i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&#x27;Map添加&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&#x27;对象添加&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">    obj[i] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&#x27;对象添加&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-方法和特性对比"><a href="#5-方法和特性对比" class="headerlink" title="5. 方法和特性对比"></a>5. 方法和特性对比</h2><h3 id="Map-方法"><a href="#Map-方法" class="headerlink" title="Map 方法"></a>Map 方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>); <span class="comment">// 设置</span></span><br><span class="line">map.<span class="title function_">get</span>(<span class="string">&#x27;key&#x27;</span>); <span class="comment">// 获取</span></span><br><span class="line">map.<span class="title function_">has</span>(<span class="string">&#x27;key&#x27;</span>); <span class="comment">// 检查存在</span></span><br><span class="line">map.<span class="title function_">delete</span>(<span class="string">&#x27;key&#x27;</span>); <span class="comment">// 删除</span></span><br><span class="line">map.<span class="title function_">clear</span>(); <span class="comment">// 清空</span></span><br><span class="line">map.<span class="title function_">forEach</span>(<span class="function">(<span class="params">value, key</span>) =&gt;</span> &#123;&#125;); <span class="comment">// 遍历</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象方法"><a href="#对象方法" class="headerlink" title="对象方法"></a>对象方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">key</span> = <span class="string">&#x27;value&#x27;</span>; <span class="comment">// 设置</span></span><br><span class="line">obj.<span class="property">key</span>; <span class="comment">// 获取</span></span><br><span class="line"><span class="string">&#x27;key&#x27;</span> <span class="keyword">in</span> obj; <span class="comment">// 检查存在</span></span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">key</span>; <span class="comment">// 删除</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;&#125;); <span class="comment">// 遍历</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-原型链问题"><a href="#6-原型链问题" class="headerlink" title="6. 原型链问题"></a>6. 原型链问题</h2><h3 id="Map-没有原型链干扰"><a href="#Map-没有原型链干扰" class="headerlink" title="Map - 没有原型链干扰"></a>Map - 没有原型链干扰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(<span class="string">&#x27;toString&#x27;</span>)); <span class="comment">// undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象-有原型链"><a href="#对象-有原型链" class="headerlink" title="对象 - 有原型链"></a>对象 - 有原型链</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">toString</span>); <span class="comment">// ƒ toString() &#123; [native code] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 安全创建无原型对象</span></span><br><span class="line"><span class="keyword">const</span> safeObj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(safeObj.<span class="property">toString</span>); <span class="comment">// undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7-序列化"><a href="#7-序列化" class="headerlink" title="7. 序列化"></a>7. 序列化</h2><h3 id="对象-可-JSON-序列化"><a href="#对象-可-JSON-序列化" class="headerlink" title="对象 - 可 JSON 序列化"></a>对象 - 可 JSON 序列化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj)); <span class="comment">// &#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Map-不能直接序列化"><a href="#Map-不能直接序列化" class="headerlink" title="Map - 不能直接序列化"></a>Map - 不能直接序列化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>]]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(map)); <span class="comment">// &#x27;&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要转换</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>([...map])); <span class="comment">// &#x27;[[&quot;a&quot;,1],[&quot;b&quot;,2]]&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="8-使用场景总结"><a href="#8-使用场景总结" class="headerlink" title="8. 使用场景总结"></a>8. 使用场景总结</h2><h3 id="使用-Map-的情况："><a href="#使用-Map-的情况：" class="headerlink" title="使用 Map 的情况："></a>使用 Map 的情况：</h3><ul><li>键类型多样（对象、函数等作为键）</li><li>需要频繁增删键值对</li><li>需要保持插入顺序</li><li>大数据量操作</li></ul><h3 id="使用对象的情况："><a href="#使用对象的情况：" class="headerlink" title="使用对象的情况："></a>使用对象的情况：</h3><ul><li>键都是字符串或 Symbol</li><li>需要 JSON 序列化</li><li>简单的配置、数据存储</li><li>方法和属性的集合</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map 适合的场景</span></span><br><span class="line"><span class="keyword">const</span> userSessions = <span class="keyword">new</span> <span class="title class_">Map</span>(); <span class="comment">// 用户会话存储，键是用户对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象适合的场景</span></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="attr">apiUrl</span>: <span class="string">&#x27;https://api.example.com&#x27;</span>,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">5000</span>,</span><br><span class="line">    <span class="attr">retryCount</span>: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>选择依据：如果需要复杂键或高性能操作，用 Map；如果是简单数据结构，用对象。</p><p>希望这些信息能帮助您。如果还有其他想了解的，随时可以留言。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在 JavaScript 中，&lt;code&gt;new Map&lt;/code&gt; 和普通对象 &lt;code&gt;{}&lt;/code&gt; 都是键值对集合，但它们有重要区别：&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="Map" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/Map/"/>
    
    
    <category term="对象" scheme="https://xuehuayu.cn/tags/%E5%AF%B9%E8%B1%A1/"/>
    
    <category term="Map" scheme="https://xuehuayu.cn/tags/Map/"/>
    
    <category term="集合" scheme="https://xuehuayu.cn/tags/%E9%9B%86%E5%90%88/"/>
    
  </entry>
  
  <entry>
    <title>Husky 在前端项目中的使用指南</title>
    <link href="https://xuehuayu.cn/article/e36b137f.html"/>
    <id>https://xuehuayu.cn/article/e36b137f.html</id>
    <published>2025-10-23T11:41:03.000Z</published>
    <updated>2025-12-04T09:10:12.198Z</updated>
    
    <content type="html"><![CDATA[<p>Husky 是一个 Git hooks 工具，可以让我们在 Git 操作的特定阶段（如提交前、推送前）自动执行脚本，常用于代码质量检查、测试运行等。</p><span id="more"></span><h2 id="安装与配置-Husky"><a href="#安装与配置-Husky" class="headerlink" title="安装与配置 Husky"></a>安装与配置 Husky</h2><h3 id="1-安装-Husky"><a href="#1-安装-Husky" class="headerlink" title="1. 安装 Husky"></a>1. 安装 Husky</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 使用 npm</span></span><br><span class="line"></span><br><span class="line">npm install husky --save-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 yarn</span></span><br><span class="line"></span><br><span class="line">yarn add husky --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 pnpm</span></span><br><span class="line"></span><br><span class="line">pnpm add husky -D</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-启用-Git-hooks"><a href="#2-启用-Git-hooks" class="headerlink" title="2. 启用 Git hooks"></a>2. 启用 Git hooks</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 初始化 Husky</span></span><br><span class="line"></span><br><span class="line">npx husky init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者手动创建 .husky 目录</span></span><br><span class="line"></span><br><span class="line">npm pkg <span class="built_in">set</span> scripts.prepare=<span class="string">&quot;husky install&quot;</span></span><br><span class="line">npm run prepare</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-添加-hooks"><a href="#3-添加-hooks" class="headerlink" title="3. 添加 hooks"></a>3. 添加 hooks</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 添加 pre-commit hook</span></span><br><span class="line"></span><br><span class="line">npx husky add .husky/pre-commit <span class="string">&quot;npm test&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 commit-msg hook</span></span><br><span class="line"></span><br><span class="line">npx husky add .husky/commit-msg <span class="string">&#x27;npx --no -- commitlint --edit &quot;$1&quot;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="常用配置示例"><a href="#常用配置示例" class="headerlink" title="常用配置示例"></a>常用配置示例</h2><h3 id="1-Pre-commit-钩子配置"><a href="#1-Pre-commit-钩子配置" class="headerlink" title="1. Pre-commit 钩子配置"></a>1. Pre-commit 钩子配置</h3><p>在 <code>.husky/pre-commit</code> 文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line">. <span class="string">&quot;<span class="subst">$(dirname -- <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行 lint 检查</span></span><br><span class="line"></span><br><span class="line">npm run lint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行测试</span></span><br><span class="line"></span><br><span class="line">npm <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查代码格式</span></span><br><span class="line"></span><br><span class="line">npm run format:check</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-Commit-msg-钩子配置"><a href="#2-Commit-msg-钩子配置" class="headerlink" title="2. Commit-msg 钩子配置"></a>2. Commit-msg 钩子配置</h3><p>在 <code>.husky/commit-msg</code> 文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line">. <span class="string">&quot;<span class="subst">$(dirname -- <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 commitlint 检查提交信息格式</span></span><br><span class="line"></span><br><span class="line">npx --no -- commitlint --edit <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-Pre-push-钩子配置"><a href="#3-Pre-push-钩子配置" class="headerlink" title="3. Pre-push 钩子配置"></a>3. Pre-push 钩子配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line">. <span class="string">&quot;<span class="subst">$(dirname -- <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在推送前运行完整测试</span></span><br><span class="line"></span><br><span class="line">npm run <span class="built_in">test</span>:ci</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配合其他工具使用"><a href="#配合其他工具使用" class="headerlink" title="配合其他工具使用"></a>配合其他工具使用</h2><h3 id="1-配合-ESLint"><a href="#1-配合-ESLint" class="headerlink" title="1. 配合 ESLint"></a>1. 配合 ESLint</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># pre-commit 文件内容</span></span><br><span class="line"></span><br><span class="line">npm run lint:fix</span><br><span class="line">git add .</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-配合-Prettier"><a href="#2-配合-Prettier" class="headerlink" title="2. 配合 Prettier"></a>2. 配合 Prettier</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># pre-commit 文件内容</span></span><br><span class="line"></span><br><span class="line">npm run format</span><br><span class="line">git add .</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-配合-lint-staged"><a href="#3-配合-lint-staged" class="headerlink" title="3. 配合 lint-staged"></a>3. 配合 lint-staged</h3><p>首先安装 lint-staged：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install lint-staged --save-dev</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后在 <code>package.json</code> 中配置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;*.&#123;js,jsx,ts,tsx&#125;&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;eslint --fix&quot;</span><span class="punctuation">,</span> <span class="string">&quot;prettier --write&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.&#123;json,md,html,css,scss&#125;&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;prettier --write&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在 <code>.husky/pre-commit</code> 中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line">. <span class="string">&quot;<span class="subst">$(dirname -- <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span></span><br><span class="line"></span><br><span class="line">npx lint-staged</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="完整配置示例"><a href="#完整配置示例" class="headerlink" title="完整配置示例"></a>完整配置示例</h2><h3 id="package-json-配置"><a href="#package-json-配置" class="headerlink" title="package.json 配置"></a>package.json 配置</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;prepare&quot;</span><span class="punctuation">:</span> <span class="string">&quot;husky install&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint . --ext .js,.jsx,.ts,.tsx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lint:fix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint . --ext .js,.jsx,.ts,.tsx --fix&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier --write .&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;format:check&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier --check .&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test:ci&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --ci --coverage&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;husky&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^8.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^13.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eslint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^8.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prettier&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^29.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;*.&#123;js,jsx,ts,tsx&#125;&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;eslint --fix&quot;</span><span class="punctuation">,</span> <span class="string">&quot;prettier --write&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.&#123;json,md,html,css,scss,yml&#125;&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;prettier --write&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="husky-目录结构"><a href="#husky-目录结构" class="headerlink" title=".husky 目录结构"></a>.husky 目录结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.husky/</span><br><span class="line">├── _</span><br><span class="line">│ └── husky.sh</span><br><span class="line">├── pre-commit</span><br><span class="line">├── commit-msg</span><br><span class="line">└── pre-push</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="跳过-hooks（特殊情况）"><a href="#跳过-hooks（特殊情况）" class="headerlink" title="跳过 hooks（特殊情况）"></a>跳过 hooks（特殊情况）</h2><p>在某些情况下，你可能需要跳过 hooks：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 跳过所有 hooks</span></span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">&quot;message&quot;</span> --no-verify</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用缩写</span></span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">&quot;message&quot;</span> -n</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol><li><strong>保持 hooks 快速执行</strong> - 避免在 pre-commit 中运行耗时很长的任务</li><li><strong>只检查暂存区的文件</strong> - 使用 lint-staged 只对将要提交的文件进行检查</li><li><strong>提供清晰的错误信息</strong> - 当检查失败时，给出明确的修复指导</li><li><strong>团队统一配置</strong> - 确保团队所有成员使用相同的 hooks 配置</li></ol><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="1-Hook-不执行"><a href="#1-Hook-不执行" class="headerlink" title="1. Hook 不执行"></a>1. Hook 不执行</h3><p>确保文件有执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x .husky/*</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-Windows-兼容性"><a href="#2-Windows-兼容性" class="headerlink" title="2. Windows 兼容性"></a>2. Windows 兼容性</h3><p>在 Windows 系统中，确保使用 Git Bash 或 WSL 来执行 hooks。</p><h3 id="3-性能优化"><a href="#3-性能优化" class="headerlink" title="3. 性能优化"></a>3. 性能优化</h3><p>对于大型项目，可以：</p><ul><li>使用缓存（如 ESLint cache）</li><li>只检查修改的文件</li><li>并行执行任务</li></ul><p>这样配置后，Husky 会在每次提交时自动运行代码质量检查，确保团队代码风格一致且质量达标。</p><p>希望这些信息能帮助您。如果还有其他想了解的，随时可以留言。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Husky 是一个 Git hooks 工具，可以让我们在 Git 操作的特定阶段（如提交前、推送前）自动执行脚本，常用于代码质量检查、测试运行等。&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="Git" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/Git/"/>
    
    
    <category term="Hooks" scheme="https://xuehuayu.cn/tags/Hooks/"/>
    
    <category term="Git" scheme="https://xuehuayu.cn/tags/Git/"/>
    
    <category term="Husky" scheme="https://xuehuayu.cn/tags/Husky/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript 中的 args 详解，和 arguments 有什么不同？</title>
    <link href="https://xuehuayu.cn/article/56271070.html"/>
    <id>https://xuehuayu.cn/article/56271070.html</id>
    <published>2025-10-23T10:29:46.000Z</published>
    <updated>2025-12-04T09:10:12.199Z</updated>
    
    <content type="html"><![CDATA[<p><code>args</code> 在 TypeScript 中通常指<strong>函数参数</strong>，特别是<strong>剩余参数（rest parameters）</strong>。让我详细解释各种用法和场景。</p><span id="more"></span><h2 id="1-剩余参数（Rest-Parameters）"><a href="#1-剩余参数（Rest-Parameters）" class="headerlink" title="1. 剩余参数（Rest Parameters）"></a>1. 剩余参数（Rest Parameters）</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 ...args 收集所有参数到一个数组中</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">...args: <span class="built_in">number</span>[]</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, current</span>) =&gt;</span> total + current, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)); <span class="comment">// 15</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">10</span>, <span class="number">20</span>)); <span class="comment">// 30</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="带固定参数的剩余参数"><a href="#带固定参数的剩余参数" class="headerlink" title="带固定参数的剩余参数"></a>带固定参数的剩余参数</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params">greeting: <span class="built_in">string</span>, ...names: <span class="built_in">string</span>[]</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;greeting&#125;</span>, <span class="subst">$&#123;names.join(<span class="string">&#x27;, &#x27;</span>)&#125;</span>!`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">greet</span>(<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>));</span><br><span class="line"><span class="comment">// &quot;Hello, Alice, Bob, Charlie!&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-函数参数对象（Arguments-Object）"><a href="#2-函数参数对象（Arguments-Object）" class="headerlink" title="2. 函数参数对象（Arguments Object）"></a>2. 函数参数对象（Arguments Object）</h2><p>在 TypeScript&#x2F;JavaScript 中，每个函数内部都可以访问 <code>arguments</code> 对象：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">traditionalSum</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    total += <span class="variable language_">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">traditionalSum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 6</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：<code>arguments</code> 不是数组，而是<strong>类数组对象</strong>。</p><h2 id="3-元组类型的剩余参数"><a href="#3-元组类型的剩余参数" class="headerlink" title="3. 元组类型的剩余参数"></a>3. 元组类型的剩余参数</h2><p>TypeScript 允许对剩余参数使用元组类型：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 固定长度和类型的剩余参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processData</span>(<span class="params">name: <span class="built_in">string</span>, ...[first, second]: [<span class="built_in">number</span>, <span class="built_in">number</span>]</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Name: <span class="subst">$&#123;name&#125;</span>, Numbers: <span class="subst">$&#123;first&#125;</span>, <span class="subst">$&#123;second&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">processData</span>(<span class="string">&quot;John&quot;</span>, <span class="number">10</span>, <span class="number">20</span>); <span class="comment">// 正常</span></span><br><span class="line"><span class="comment">// processData(&quot;John&quot;, 10); // 错误：缺少第二个数字参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 混合类型的剩余参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mixedArgs</span>(<span class="params">...args: [<span class="built_in">string</span>, <span class="built_in">number</span>, ...<span class="built_in">boolean</span>[]]</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">mixedArgs</span>(<span class="string">&quot;hello&quot;</span>, <span class="number">42</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-在箭头函数中的使用"><a href="#4-在箭头函数中的使用" class="headerlink" title="4. 在箭头函数中的使用"></a>4. 在箭头函数中的使用</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 箭头函数中的剩余参数</span></span><br><span class="line"><span class="keyword">const</span> multiplyAll = (...<span class="attr">numbers</span>: <span class="built_in">number</span>[]): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> numbers.<span class="title function_">reduce</span>(<span class="function">(<span class="params">product, num</span>) =&gt;</span> product * num, <span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">multiplyAll</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// 24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 带泛型的剩余参数</span></span><br><span class="line"><span class="keyword">const</span> mergeArrays = &lt;T&gt;(...<span class="attr">arrays</span>: T[][]): T[] =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> arrays.<span class="title function_">flat</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">mergeArrays</span>([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-实际应用场景"><a href="#5-实际应用场景" class="headerlink" title="5. 实际应用场景"></a>5. 实际应用场景</h2><h3 id="场景-1：高阶函数和装饰器"><a href="#场景-1：高阶函数和装饰器" class="headerlink" title="场景 1：高阶函数和装饰器"></a>场景 1：高阶函数和装饰器</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数日志装饰器</span></span><br><span class="line"><span class="keyword">function</span> logExecution&lt;T <span class="keyword">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span>&gt;(</span><br><span class="line">  <span class="attr">target</span>: T</span><br><span class="line">): <span class="function">(<span class="params">...args: Parameters&lt;T&gt;</span>) =&gt;</span> <span class="title class_">ReturnType</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args: Parameters&lt;T&gt;</span>): <span class="title class_">ReturnType</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`函数被调用，参数:`</span>, args);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">target</span>(...args);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`函数返回:`</span>, result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loggedSum = <span class="title function_">logExecution</span>(sum);</span><br><span class="line"><span class="title function_">loggedSum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// 会输出调用日志</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="场景-2：配置合并"><a href="#场景-2：配置合并" class="headerlink" title="场景 2：配置合并"></a>场景 2：配置合并</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">  timeout?: <span class="built_in">number</span>;</span><br><span class="line">  retries?: <span class="built_in">number</span>;</span><br><span class="line">  baseURL?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createApiClient</span>(<span class="params">defaultConfig: Config, ...configs: Partial&lt;Config&gt;[]</span>): <span class="title class_">Config</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> configs.<span class="title function_">reduce</span>(<span class="function">(<span class="params">merged, config</span>) =&gt;</span> (&#123; ...merged, ...config &#125;), defaultConfig);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="title function_">createApiClient</span>(</span><br><span class="line">  &#123; <span class="attr">timeout</span>: <span class="number">5000</span>, <span class="attr">baseURL</span>: <span class="string">&quot;/api&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">retries</span>: <span class="number">3</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">timeout</span>: <span class="number">3000</span> &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 结果: &#123; timeout: 3000, baseURL: &quot;/api&quot;, retries: 3 &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="场景-3：事件处理器"><a href="#场景-3：事件处理器" class="headerlink" title="场景 3：事件处理器"></a>场景 3：事件处理器</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventEmitter</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">events</span>: <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>[]&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">on</span>(<span class="attr">event</span>: <span class="built_in">string</span>, ...<span class="attr">handlers</span>: (<span class="function">(<span class="params">...args: <span class="built_in">any</span>[]</span>) =&gt;</span> <span class="built_in">void</span>)[]): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">events</span>.<span class="title function_">has</span>(event)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">events</span>.<span class="title function_">set</span>(event, []);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>.<span class="title function_">get</span>(event)!.<span class="title function_">push</span>(...handlers);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">emit</span>(<span class="attr">event</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handlers = <span class="variable language_">this</span>.<span class="property">events</span>.<span class="title function_">get</span>(event) || [];</span><br><span class="line">    handlers.<span class="title function_">forEach</span>(<span class="function"><span class="params">handler</span> =&gt;</span> <span class="title function_">handler</span>(...args));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();</span><br><span class="line">emitter.<span class="title function_">on</span>(<span class="string">&quot;message&quot;</span>, <span class="function">(<span class="params">msg: <span class="built_in">string</span>, priority: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`消息: <span class="subst">$&#123;msg&#125;</span>, 优先级: <span class="subst">$&#123;priority&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Hello World&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-泛型与剩余参数"><a href="#6-泛型与剩余参数" class="headerlink" title="6. 泛型与剩余参数"></a>6. 泛型与剩余参数</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 泛型剩余参数 - 保持类型安全</span></span><br><span class="line"><span class="keyword">function</span> callAll&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt;(</span><br><span class="line">  ...<span class="attr">functions</span>: (<span class="function">(<span class="params">...args: T</span>) =&gt;</span> <span class="built_in">void</span>)[]</span><br><span class="line">): <span class="function">(<span class="params">...args: T</span>) =&gt;</span> <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args: T</span>) =&gt;</span> &#123;</span><br><span class="line">    functions.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>(...args));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">logger</span> = (<span class="params">msg: <span class="built_in">string</span>, count: <span class="built_in">number</span></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(msg, count);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">storage</span> = (<span class="params">msg: <span class="built_in">string</span>, count: <span class="built_in">number</span></span>) =&gt; <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;last&#x27;</span>, msg);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> combined = <span class="title function_">callAll</span>(logger, storage);</span><br><span class="line"><span class="title function_">combined</span>(<span class="string">&quot;test&quot;</span>, <span class="number">5</span>); <span class="comment">// 两个函数都会接收到 &quot;test&quot; 和 5</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7-类型工具与-args"><a href="#7-类型工具与-args" class="headerlink" title="7. 类型工具与 args"></a>7. 类型工具与 <code>args</code></h2><h3 id="Parameters-工具类型"><a href="#Parameters-工具类型" class="headerlink" title="Parameters 工具类型"></a>Parameters 工具类型</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取函数的参数类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SumParams</span> = <span class="title class_">Parameters</span>&lt;<span class="keyword">typeof</span> sum&gt;; <span class="comment">// [number[]]</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">GreetParams</span> = <span class="title class_">Parameters</span>&lt;<span class="keyword">typeof</span> greet&gt;; <span class="comment">// [string, ...string[]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现一个包装函数</span></span><br><span class="line"><span class="keyword">function</span> withRetry&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[], R&gt;(</span><br><span class="line">  <span class="attr">fn</span>: <span class="function">(<span class="params">...args: T</span>) =&gt;</span> R,</span><br><span class="line">  <span class="attr">retries</span>: <span class="built_in">number</span></span><br><span class="line">): <span class="function">(<span class="params">...args: T</span>) =&gt;</span> R &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args: T</span>): R &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">lastError</span>: <span class="title class_">Error</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; retries; i++) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fn</span>(...args);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        lastError = error <span class="keyword">as</span> <span class="title class_">Error</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> lastError!;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="8-常见模式和最佳实践"><a href="#8-常见模式和最佳实践" class="headerlink" title="8. 常见模式和最佳实践"></a>8. 常见模式和最佳实践</h2><h3 id="模式-1：参数验证"><a href="#模式-1：参数验证" class="headerlink" title="模式 1：参数验证"></a>模式 1：参数验证</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">validateAndProcess</span>(<span class="params">...inputs: (<span class="built_in">string</span> | <span class="built_in">number</span>)[]</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (inputs.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;至少需要一个参数&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  inputs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">input, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (input === <span class="literal">null</span> || input === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`参数 <span class="subst">$&#123;index&#125;</span> 不能为 null 或 undefined`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理逻辑...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="模式-2：函数组合"><a href="#模式-2：函数组合" class="headerlink" title="模式 2：函数组合"></a>模式 2：函数组合</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> compose&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt;(</span><br><span class="line">  ...<span class="attr">functions</span>: (<span class="function">(<span class="params">...args: T</span>) =&gt;</span> <span class="built_in">void</span>)[]</span><br><span class="line">): <span class="function">(<span class="params">...args: T</span>) =&gt;</span> <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args: T</span>) =&gt;</span> &#123;</span><br><span class="line">    functions.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>(...args);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;函数执行错误:&#x27;</span>, error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="模式-3：条件参数处理"><a href="#模式-3：条件参数处理" class="headerlink" title="模式 3：条件参数处理"></a>模式 3：条件参数处理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flexibleProcessor</span>(<span class="params"></span></span><br><span class="line"><span class="params">  required: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  ...optional: (<span class="built_in">number</span> | <span class="built_in">string</span>)[]</span></span><br><span class="line"><span class="params"></span>): &#123; <span class="attr">required</span>: <span class="built_in">string</span>; <span class="attr">optional</span>: (<span class="built_in">number</span> | <span class="built_in">string</span>)[] &#125; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> processedOptional = optional.<span class="title function_">map</span>(<span class="function"><span class="params">arg</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> arg === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> arg.<span class="title function_">toUpperCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arg * <span class="number">2</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; required, <span class="attr">optional</span>: processedOptional &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="9-注意事项"><a href="#9-注意事项" class="headerlink" title="9. 注意事项"></a>9. 注意事项</h2><h3 id="注意-1：arguments-vs-剩余参数"><a href="#注意-1：arguments-vs-剩余参数" class="headerlink" title="注意 1：arguments vs 剩余参数"></a>注意 1：<code>arguments</code> vs 剩余参数</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 传统方式 - 没有类型安全</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">oldWay</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>[<span class="number">0</span>], <span class="variable language_">arguments</span>[<span class="number">1</span>]); <span class="comment">// 没有类型提示</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 现代方式 - 类型安全</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">newWay</span>(<span class="params">...args: [<span class="built_in">string</span>, <span class="built_in">number</span>]</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">0</span>], args[<span class="number">1</span>]); <span class="comment">// 有完整的类型提示</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="注意-2：性能考虑"><a href="#注意-2：性能考虑" class="headerlink" title="注意 2：性能考虑"></a>注意 2：性能考虑</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对于性能敏感的场景，避免在热路径中使用剩余参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">optimizedSum</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span>, c?: <span class="built_in">number</span>, d?: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> total = a + b;</span><br><span class="line">  <span class="keyword">if</span> (c !== <span class="literal">undefined</span>) total += c;</span><br><span class="line">  <span class="keyword">if</span> (d !== <span class="literal">undefined</span>) total += d;</span><br><span class="line">  <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 比使用 ...args: number[] 更高效</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="💎-总结"><a href="#💎-总结" class="headerlink" title="💎 总结"></a>💎 总结</h2><p>在 TypeScript 中，<code>args</code> 主要涉及：</p><ol><li><strong>剩余参数</strong> (<code>...args</code>)：收集多个参数到数组</li><li><strong><code>arguments</code> 对象</strong>：函数内可访问的类数组对象</li><li><strong>元组类型的剩余参数</strong>：提供更精确的类型控制</li><li><strong>泛型剩余参数</strong>：保持类型安全的可变参数</li></ol><p><strong>最佳实践</strong>：</p><ul><li>优先使用剩余参数而非 <code>arguments</code> 对象</li><li>为剩余参数提供明确的类型注解</li><li>在需要精确类型控制时使用元组类型</li><li>考虑性能影响，在热路径中避免不必要的数组创建</li></ul><p><code>args</code> 是 TypeScript 函数编程中的重要概念，合理使用可以大大增强代码的灵活性和类型安全性。</p><p>希望这些信息能帮助您。如果还有其他想了解的，随时可以留言。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;args&lt;/code&gt; 在 TypeScript 中通常指&lt;strong&gt;函数参数&lt;/strong&gt;，特别是&lt;strong&gt;剩余参数（rest parameters）&lt;/strong&gt;。让我详细解释各种用法和场景。&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="TypeScript" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/TypeScript/"/>
    
    
    <category term="TypeScript" scheme="https://xuehuayu.cn/tags/TypeScript/"/>
    
    <category term="arguments" scheme="https://xuehuayu.cn/tags/arguments/"/>
    
    <category term="args" scheme="https://xuehuayu.cn/tags/args/"/>
    
    <category term="参数" scheme="https://xuehuayu.cn/tags/%E5%8F%82%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript中as const断言和const声明变量的区别是什么？</title>
    <link href="https://xuehuayu.cn/article/8c6832b5.html"/>
    <id>https://xuehuayu.cn/article/8c6832b5.html</id>
    <published>2025-10-23T09:09:22.000Z</published>
    <updated>2025-12-04T09:10:12.204Z</updated>
    
    <content type="html"><![CDATA[<p>在TypeScript中，<code>let array = [1, 2, 3] as const</code> 和 <code>const array = [1, 2, 3]</code> 的主要区别在于<strong>数组元素的可变性</strong>和<strong>类型推断的宽窄</strong>。</p><span id="more"></span><p>为了帮你快速把握核心区别，可以先看这个表格：</p><table><thead><tr><th>特性维度</th><th><code>let array = [1, 2, 3] as const</code></th><th><code>const array = [1, 2, 3]</code></th></tr></thead><tbody><tr><td><strong>变量绑定</strong></td><td><code>array</code> 变量绑定可变更 (可重新赋值)</td><td><code>array</code> 变量绑定不可变 (不可重新赋值)</td></tr><tr><td><strong>数组元素</strong></td><td>元素<strong>不可变</strong> (只读元组)，不能增删改</td><td>元素<strong>可变</strong>，可以增删改元素</td></tr><tr><td><strong>推断类型</strong></td><td>被推断为 <code>readonly [1, 2, 3]</code> (<strong>字面量只读元组</strong>，非常精确)</td><td>被推断为 <code>number[]</code> (<strong>通用数字数组</strong>，类型较宽泛)</td></tr><tr><td><strong>适用场景</strong></td><td>需要<strong>绝对恒定</strong>、结构固定的数据，如配置、枚举、函数返回值</td><td>变量引用<strong>不可变</strong>，但数组内容需要<strong>动态变化</strong>的情况</td></tr></tbody></table><h3 id="🔍-理解类型推断和可变性"><a href="#🔍-理解类型推断和可变性" class="headerlink" title="🔍 理解类型推断和可变性"></a>🔍 理解类型推断和可变性</h3><ul><li><p><strong>类型推断的差异</strong>：</p><ul><li>使用 <code>as const</code> 后，TypeScript 会将数组推断为一个<strong>只读的元组</strong>（readonly tuple），每个元素都会被视为它具体的字面量类型（如 <code>1</code>，<code>2</code>，<code>3</code>）。这被称为 <strong>const 上下文</strong>。</li><li>仅使用 <code>const</code> 声明数组，TypeScript 通常会将数组类型推断为相对宽泛的元素类型数组，例如 <code>number[]</code>。</li></ul></li><li><p><strong>可变性的区别</strong>：</p><ul><li><code>as const</code> 断言使得数组本身和其所有元素都变为<strong>只读</strong>（readonly），你不能对数组进行添加、删除或修改元素的操作。</li><li>使用 <code>const</code> 声明的数组，其变量引用不可重新赋值，但你可以修改数组内部的内容，比如使用 <code>push()</code>、<code>pop()</code> 或直接通过索引修改元素。</li></ul></li></ul><h3 id="💡-如何选择使用"><a href="#💡-如何选择使用" class="headerlink" title="💡 如何选择使用"></a>💡 如何选择使用</h3><ul><li>当你需要一个<strong>结构固定、内容绝对不允许修改</strong>的数组时，使用 <code>as const</code>。这常见于配置项、枚举值列表或需要精确类型推断的场景。</li><li>当你需要确保<strong>变量引用不变</strong>，但<strong>数组内容可能需要动态变化</strong>时，使用 <code>const</code> 声明数组。</li></ul><h3 id="⚠️-补充说明"><a href="#⚠️-补充说明" class="headerlink" title="⚠️ 补充说明"></a>⚠️ 补充说明</h3><p>需要注意的是，<code>as const</code> 断言会从编译后的 JavaScript 代码中完全删除，它仅在 TypeScript 的类型检查阶段起作用。这意味着使用或不使用 <code>as const</code>，应用程序在运行时的行为完全没有区别。</p><p>希望这些信息能帮助您。如果还有其他想了解的，随时可以留言。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在TypeScript中，&lt;code&gt;let array = [1, 2, 3] as const&lt;/code&gt; 和 &lt;code&gt;const array = [1, 2, 3]&lt;/code&gt; 的主要区别在于&lt;strong&gt;数组元素的可变性&lt;/strong&gt;和&lt;strong&gt;类型推断的宽窄&lt;/strong&gt;。&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="TypeScript" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/TypeScript/"/>
    
    
    <category term="TypeScript" scheme="https://xuehuayu.cn/tags/TypeScript/"/>
    
    <category term="断言" scheme="https://xuehuayu.cn/tags/%E6%96%AD%E8%A8%80/"/>
    
    <category term="asserts" scheme="https://xuehuayu.cn/tags/asserts/"/>
    
    <category term="cosnt" scheme="https://xuehuayu.cn/tags/cosnt/"/>
    
    <category term="as const" scheme="https://xuehuayu.cn/tags/as-const/"/>
    
    <category term="常量" scheme="https://xuehuayu.cn/tags/%E5%B8%B8%E9%87%8F/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript 断言详解及示例</title>
    <link href="https://xuehuayu.cn/article/6ff625e1.html"/>
    <id>https://xuehuayu.cn/article/6ff625e1.html</id>
    <published>2025-10-23T08:54:54.000Z</published>
    <updated>2025-12-04T09:10:12.201Z</updated>
    
    <content type="html"><![CDATA[<p>TypeScript 断言用于告诉编译器「你比它更了解类型」，让编译器信任开发者的判断。</p><span id="more"></span><h2 id="1-类型断言-Type-Assertions"><a href="#1-类型断言-Type-Assertions" class="headerlink" title="1. 类型断言 (Type Assertions)"></a>1. 类型断言 (Type Assertions)</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式1: 尖括号语法</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">someValue</span>: <span class="built_in">any</span> = <span class="string">&quot;this is a string&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">strLength</span>: <span class="built_in">number</span> = (&lt;<span class="built_in">string</span>&gt;someValue).<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2: as 语法 (推荐，尤其在 JSX 中)</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">strLengthAs</span>: <span class="built_in">number</span> = (someValue <span class="keyword">as</span> <span class="built_in">string</span>).<span class="property">length</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="常见使用场景"><a href="#常见使用场景" class="headerlink" title="常见使用场景"></a>常见使用场景</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 将 any 断言为具体类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">unknownValue</span>: <span class="built_in">any</span> = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">str1</span>: <span class="built_in">string</span> = (&lt;<span class="built_in">string</span>&gt;unknownValue);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">str2</span>: <span class="built_in">string</span> = (unknownValue <span class="keyword">as</span> <span class="built_in">string</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 将联合类型断言为其中一个类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">meow</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">bark</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPet</span>(<span class="params"></span>): <span class="title class_">Cat</span> | <span class="title class_">Dog</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&quot;Buddy&quot;</span>, <span class="attr">meow</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;meow&quot;</span>) &#125; <span class="keyword">as</span> <span class="title class_">Cat</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pet = <span class="title function_">getPet</span>();</span><br><span class="line">(pet <span class="keyword">as</span> <span class="title class_">Cat</span>).<span class="title function_">meow</span>(); <span class="comment">// 断言为 Cat 类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将父类断言为更具体的子类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">fly</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> is flying`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">animal</span>: <span class="title class_">Animal</span> = <span class="keyword">new</span> <span class="title class_">Bird</span>(<span class="string">&quot;Sparrow&quot;</span>);</span><br><span class="line">(animal <span class="keyword">as</span> <span class="title class_">Bird</span>).<span class="title function_">fly</span>(); <span class="comment">// 断言为 Bird 类型</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-非空断言-Non-null-Assertion"><a href="#2-非空断言-Non-null-Assertion" class="headerlink" title="2. 非空断言 (Non-null Assertion)"></a>2. 非空断言 (Non-null Assertion)</h2><p>使用 <code>!</code> 运算符断言值不为 <code>null</code> 或 <code>undefined</code>。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 变量非空断言</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">liveDangerously</span>(<span class="params">x?: <span class="built_in">number</span> | <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 使用非空断言，告诉编译器 x 不会是 null 或 undefined</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x!.<span class="title function_">toFixed</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 函数调用非空断言</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  address?: &#123;</span><br><span class="line">    <span class="attr">street</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">city</span>: <span class="built_in">string</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">address</span>!.<span class="property">city</span>); <span class="comment">// 断言 address 存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 数组访问非空断言</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">array</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> firstElement = array[<span class="number">0</span>]!; <span class="comment">// 断言第一个元素存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 与可选链结合使用</span></span><br><span class="line"><span class="keyword">let</span> city = user.<span class="property">address</span>?.<span class="property">city</span>!; <span class="comment">// 如果 address 存在，则 city 一定存在</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-常量断言-Const-Assertions"><a href="#3-常量断言-Const-Assertions" class="headerlink" title="3. 常量断言 (Const Assertions)"></a>3. 常量断言 (Const Assertions)</h2><p>使用 <code>as const</code> 将类型收窄为最具体的字面量类型。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 基本类型常量断言</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="string">&quot;hello&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>; <span class="comment">// 类型: &quot;hello&quot;</span></span><br><span class="line"><span class="keyword">let</span> y = <span class="number">42</span> <span class="keyword">as</span> <span class="keyword">const</span>; <span class="comment">// 类型: 42</span></span><br><span class="line"><span class="keyword">let</span> z = <span class="literal">true</span> <span class="keyword">as</span> <span class="keyword">const</span>; <span class="comment">// 类型: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 数组常量断言</span></span><br><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">as</span> <span class="keyword">const</span>; <span class="comment">// 类型: readonly [1, 2, 3]</span></span><br><span class="line"><span class="comment">// array[0] = 4; // 错误: 无法分配到 &quot;0&quot;，因为它是只读属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 对象常量断言</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">  <span class="attr">hobbies</span>: [<span class="string">&quot;reading&quot;</span>, <span class="string">&quot;swimming&quot;</span>]</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// user.name = &quot;Bob&quot;; // 错误: 无法分配到 &quot;name&quot;，因为它是只读属性</span></span><br><span class="line"><span class="comment">// user.hobbies.push(&quot;coding&quot;); // 错误: 属性 &#x27;push&#x27; 在类型 &#x27;readonly [&quot;reading&quot;, &quot;swimming&quot;]&#x27; 上不存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 函数返回常量断言</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getConfig</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">    <span class="attr">ssl</span>: <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="title function_">getConfig</span>();</span><br><span class="line"><span class="comment">// config.host = &quot;127.0.0.1&quot;; // 错误: 无法分配到 &quot;host&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-断言函数-Assertion-Functions"><a href="#4-断言函数-Assertion-Functions" class="headerlink" title="4. 断言函数 (Assertion Functions)"></a>4. 断言函数 (Assertion Functions)</h2><p>用于在运行时验证条件，并在类型层面反映验证结果。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 断言函数 - 简单形式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assert</span>(<span class="params">condition: <span class="built_in">any</span>, msg?: <span class="built_in">string</span></span>): asserts condition &#123;</span><br><span class="line">  <span class="keyword">if</span> (!condition) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processValue</span>(<span class="params">value: <span class="built_in">number</span> | <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="title function_">assert</span>(<span class="keyword">typeof</span> value === <span class="string">&quot;number&quot;</span>, <span class="string">&quot;Value must be a number&quot;</span>);</span><br><span class="line">  <span class="comment">// 这里 value 的类型被收窄为 number</span></span><br><span class="line">  <span class="keyword">return</span> value.<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 断言函数 - 类型谓词形式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isString</span>(<span class="params">value: <span class="built_in">any</span></span>): value is <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">&quot;string&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertIsString</span>(<span class="params">value: <span class="built_in">any</span></span>): asserts value is <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isString</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Value must be a string&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">example</span>(<span class="params">x: <span class="built_in">number</span> | <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="title function_">assertIsString</span>(x);</span><br><span class="line">  <span class="comment">// 这里 x 的类型被收窄为 string</span></span><br><span class="line">  <span class="keyword">return</span> x.<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 复杂类型断言函数</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">  <span class="title function_">meow</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">  <span class="title function_">bark</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isCat</span>(<span class="params">pet: Cat | Dog</span>): pet is <span class="title class_">Cat</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (pet <span class="keyword">as</span> <span class="title class_">Cat</span>).<span class="property">meow</span> !== <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertIsCat</span>(<span class="params">pet: Cat | Dog</span>): asserts pet is <span class="title class_">Cat</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isCat</span>(pet)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Pet is not a cat&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-双重断言-Double-Assertion"><a href="#5-双重断言-Double-Assertion" class="headerlink" title="5. 双重断言 (Double Assertion)"></a>5. 双重断言 (Double Assertion)</h2><p>当两种类型没有直接关系时，可以先断言为 <code>any</code> 或 <code>unknown</code>。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 双重断言示例</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">children</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DivProps</span> &#123;</span><br><span class="line">  <span class="attr">className</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">buttonProps</span>: <span class="title class_">ButtonProps</span> = &#123;</span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;clicked&quot;</span>),</span><br><span class="line">  <span class="attr">children</span>: <span class="string">&quot;Click me&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接断言会报错，因为 ButtonProps 和 DivProps 不兼容</span></span><br><span class="line"><span class="comment">// let divProps: DivProps = buttonProps as DivProps; // 错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用双重断言</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">divProps</span>: <span class="title class_">DivProps</span> = buttonProps <span class="keyword">as</span> <span class="built_in">any</span> <span class="keyword">as</span> <span class="title class_">DivProps</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 更安全的做法 - 使用 unknown</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">saferDivProps</span>: <span class="title class_">DivProps</span> = buttonProps <span class="keyword">as</span> <span class="built_in">unknown</span> <span class="keyword">as</span> <span class="title class_">DivProps</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 实际应用场景 - 处理第三方库类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleEvent</span>(<span class="params">event: Event</span>) &#123;</span><br><span class="line">  <span class="comment">// 假设我们需要 MouseEvent 的特有属性</span></span><br><span class="line">  <span class="keyword">const</span> mouseEvent = event <span class="keyword">as</span> <span class="built_in">unknown</span> <span class="keyword">as</span> <span class="title class_">MouseEvent</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(mouseEvent.<span class="property">clientX</span>, mouseEvent.<span class="property">clientY</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-实际应用示例"><a href="#6-实际应用示例" class="headerlink" title="6. 实际应用示例"></a>6. 实际应用示例</h2><h3 id="示例-1-DOM-操作"><a href="#示例-1-DOM-操作" class="headerlink" title="示例 1: DOM 操作"></a>示例 1: DOM 操作</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 获取 DOM 元素</span></span><br><span class="line"><span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;myInput&quot;</span>) <span class="keyword">as</span> <span class="title class_">HTMLInputElement</span>;</span><br><span class="line">input.<span class="property">value</span> = <span class="string">&quot;Hello&quot;</span>; <span class="comment">// 现在可以访问 HTMLInputElement 的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 事件处理</span></span><br><span class="line"><span class="keyword">const</span> button = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.submit-btn&quot;</span>) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">e: Event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> mouseEvent = e <span class="keyword">as</span> <span class="title class_">MouseEvent</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Clicked at: <span class="subst">$&#123;mouseEvent.clientX&#125;</span>, <span class="subst">$&#123;mouseEvent.clientY&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 非空断言在 DOM 中的使用</span></span><br><span class="line"><span class="keyword">const</span> form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;myForm&quot;</span>)!; <span class="comment">// 确定这个元素存在</span></span><br><span class="line">form.<span class="title function_">addEventListener</span>(<span class="string">&quot;submit&quot;</span>, handleSubmit);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="示例-2-API-响应处理"><a href="#示例-2-API-响应处理" class="headerlink" title="示例 2: API 响应处理"></a>示例 2: API 响应处理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T;</span><br><span class="line">  <span class="attr">status</span>: <span class="string">&quot;success&quot;</span> | <span class="string">&quot;error&quot;</span>;</span><br><span class="line">  message?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设我们从 API 获取数据</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchUser</span>(<span class="params">userId: <span class="built_in">number</span></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>() <span class="keyword">as</span> <span class="title class_">ApiResponse</span>&lt;<span class="title class_">User</span>&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用断言确保数据格式</span></span><br><span class="line">  <span class="keyword">if</span> (result.<span class="property">status</span> === <span class="string">&quot;success&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> result.<span class="property">data</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(result.<span class="property">message</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用常量断言定义配置</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_CONFIG</span> = &#123;</span><br><span class="line">  <span class="attr">baseUrl</span>: <span class="string">&quot;https://api.example.com&quot;</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span>,</span><br><span class="line">  <span class="attr">retries</span>: <span class="number">3</span></span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="示例-3-状态管理"><a href="#示例-3-状态管理" class="headerlink" title="示例 3: 状态管理"></a>示例 3: 状态管理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">AppState</span> = &#123;</span><br><span class="line">  <span class="attr">user</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">email</span>: <span class="built_in">string</span>;</span><br><span class="line">  &#125; | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">loading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateUserProfile</span>(<span class="params">state: AppState, updates: Partial&lt;AppState[<span class="string">&quot;user&quot;</span>]&gt;</span>) &#123;</span><br><span class="line">  <span class="comment">// 使用非空断言，因为我们确定此时 user 存在</span></span><br><span class="line">  <span class="keyword">const</span> currentUser = state.<span class="property">user</span>!;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...state,</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">      ...currentUser,</span><br><span class="line">      ...updates</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用断言函数进行运行时验证</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validateUser</span>(<span class="params">user: <span class="built_in">any</span></span>): user is <span class="title class_">AppState</span>[<span class="string">&quot;user&quot;</span>] &#123;</span><br><span class="line">  <span class="keyword">return</span> user &amp;&amp;</span><br><span class="line">          <span class="keyword">typeof</span> user.<span class="property">id</span> === <span class="string">&quot;number&quot;</span> &amp;&amp;</span><br><span class="line">          <span class="keyword">typeof</span> user.<span class="property">name</span> === <span class="string">&quot;string&quot;</span> &amp;&amp;</span><br><span class="line">          <span class="keyword">typeof</span> user.<span class="property">email</span> === <span class="string">&quot;string&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setUser</span>(<span class="params">state: AppState, userData: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">validateUser</span>(userData)) &#123;</span><br><span class="line">    state.<span class="property">user</span> = userData;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Invalid user data&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7-最佳实践和注意事项"><a href="#7-最佳实践和注意事项" class="headerlink" title="7. 最佳实践和注意事项"></a>7. 最佳实践和注意事项</h2><h3 id="应该使用断言的情况："><a href="#应该使用断言的情况：" class="headerlink" title="应该使用断言的情况："></a>应该使用断言的情况：</h3><ol><li><strong>DOM 操作</strong>：确定元素类型时</li><li><strong>API 响应</strong>：处理已知结构的数据时</li><li><strong>测试代码</strong>：模拟特定场景时</li><li><strong>迁移代码</strong>：从 JavaScript 迁移时</li></ol><h3 id="应该避免的情况："><a href="#应该避免的情况：" class="headerlink" title="应该避免的情况："></a>应该避免的情况：</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误的用法 - 掩盖了真正的类型错误</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">value</span>: <span class="built_in">string</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> numberValue = value <span class="keyword">as</span> <span class="built_in">any</span> <span class="keyword">as</span> <span class="built_in">number</span>; <span class="comment">// 危险！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 更好的做法 - 进行类型检查</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">safeConvert</span>(<span class="params">str: <span class="built_in">string</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> num = <span class="title class_">Number</span>(str);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isNaN</span>(num)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Invalid number&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="断言-vs-类型守卫："><a href="#断言-vs-类型守卫：" class="headerlink" title="断言 vs 类型守卫："></a>断言 vs 类型守卫：</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用类型守卫 (更安全)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isNumber</span>(<span class="params">value: <span class="built_in">any</span></span>): value is <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">&quot;number&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">process</span>(<span class="params">value: <span class="built_in">string</span> | <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNumber</span>(value)) &#123;</span><br><span class="line">    <span class="comment">// TypeScript 知道这里 value 是 number</span></span><br><span class="line">    <span class="keyword">return</span> value.<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// TypeScript 知道这里 value 是 string</span></span><br><span class="line">    <span class="keyword">return</span> value.<span class="title function_">toUpperCase</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用断言 (需要开发者确保正确性)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processWithAssert</span>(<span class="params">value: <span class="built_in">string</span> | <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 开发者需要确保 value 确实是 number</span></span><br><span class="line">  <span class="keyword">return</span> (value <span class="keyword">as</span> <span class="built_in">number</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>总结</strong>：断言是 TypeScript 中的强大工具，但应该谨慎使用。优先考虑类型守卫和正确的类型设计，只在确实比编译器更了解类型的情况下使用断言。</p><p>希望这些信息能帮助您。如果还有其他想了解的，随时可以留言。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;TypeScript 断言用于告诉编译器「你比它更了解类型」，让编译器信任开发者的判断。&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="TypeScript" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/TypeScript/"/>
    
    
    <category term="TypeScript" scheme="https://xuehuayu.cn/tags/TypeScript/"/>
    
    <category term="Asserts" scheme="https://xuehuayu.cn/tags/Asserts/"/>
    
    <category term="断言" scheme="https://xuehuayu.cn/tags/%E6%96%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript 泛型（Generics）必须在方法名后面写 &lt;T&gt; 吗?</title>
    <link href="https://xuehuayu.cn/article/56378e04.html"/>
    <id>https://xuehuayu.cn/article/56378e04.html</id>
    <published>2025-10-23T08:52:28.000Z</published>
    <updated>2025-12-04T09:10:12.202Z</updated>
    
    <content type="html"><![CDATA[<p>TypeScript 泛型（Generics）必须在方法名后面写 <T> 吗?<br>答案是不，不一定必须在方法名后面写 <code>&lt;T&gt;</code>。泛型的声明位置取决于使用场景：</p><span id="more"></span><h2 id="1-不同位置的泛型声明"><a href="#1-不同位置的泛型声明" class="headerlink" title="1. 不同位置的泛型声明"></a>1. 不同位置的泛型声明</h2><h3 id="在类上声明（推荐用于类方法）"><a href="#在类上声明（推荐用于类方法）" class="headerlink" title="在类上声明（推荐用于类方法）"></a>在类上声明（推荐用于类方法）</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataProcessor</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">// 类方法可以直接使用类级别的泛型 T</span></span><br><span class="line">  <span class="title function_">process</span>(<span class="attr">data</span>: T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不需要在每个方法后面写 &lt;T&gt;</span></span><br><span class="line">  <span class="title function_">validate</span>(<span class="attr">data</span>: T): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> data !== <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> stringProcessor = <span class="keyword">new</span> <span class="title class_">DataProcessor</span>&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">stringProcessor.<span class="title function_">process</span>(<span class="string">&quot;hello&quot;</span>); <span class="comment">// 正确</span></span><br><span class="line"><span class="comment">// stringProcessor.process(123); // 错误，类型不匹配</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="在接口上声明"><a href="#在接口上声明" class="headerlink" title="在接口上声明"></a>在接口上声明</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Repository</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="title function_">findById</span>(<span class="attr">id</span>: <span class="built_in">number</span>): T | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="title function_">save</span>(<span class="attr">entity</span>: T): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">findAll</span>(): T[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现接口时指定具体类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserRepository</span> <span class="keyword">implements</span> <span class="title class_">Repository</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">  <span class="title function_">findById</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="title class_">User</span> | <span class="literal">undefined</span> &#123;</span><br><span class="line">    <span class="comment">// 实现...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">save</span>(<span class="attr">entity</span>: <span class="title class_">User</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 实现...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">findAll</span>(): <span class="title class_">User</span>[] &#123;</span><br><span class="line">    <span class="comment">// 实现...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="在方法上声明（独立泛型方法）"><a href="#在方法上声明（独立泛型方法）" class="headerlink" title="在方法上声明（独立泛型方法）"></a>在方法上声明（独立泛型方法）</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Utility</span> &#123;</span><br><span class="line">  <span class="comment">// 静态方法通常需要在方法上声明泛型</span></span><br><span class="line">  <span class="keyword">static</span> identity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实例方法也可以有独立的泛型</span></span><br><span class="line">  parseJson&lt;T&gt;(<span class="attr">json</span>: <span class="built_in">string</span>): T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(json);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 混合使用：使用类泛型 + 方法泛型</span></span><br><span class="line">  transform&lt;U&gt;(<span class="attr">data</span>: T, <span class="attr">transformer</span>: <span class="function">(<span class="params">input: T</span>) =&gt;</span> U): U &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">transformer</span>(data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-何时需要在方法名后写"><a href="#2-何时需要在方法名后写" class="headerlink" title="2. 何时需要在方法名后写 &lt;T&gt;"></a>2. 何时需要在方法名后写 <code>&lt;T&gt;</code></h2><h3 id="需要独立泛型参数时"><a href="#需要独立泛型参数时" class="headerlink" title="需要独立泛型参数时"></a>需要独立泛型参数时</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">  <span class="comment">// 这个方法有自己独立的泛型参数 U</span></span><br><span class="line">  convert&lt;U&gt;(<span class="attr">value</span>: <span class="built_in">number</span>, <span class="attr">converter</span>: <span class="function">(<span class="params">num: <span class="built_in">number</span></span>) =&gt;</span> U): U &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">converter</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 多个泛型参数</span></span><br><span class="line">  pair&lt;T, U&gt;(<span class="attr">first</span>: T, <span class="attr">second</span>: U): [T, U] &#123;</span><br><span class="line">    <span class="keyword">return</span> [first, second];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayHelper</span> &#123;</span><br><span class="line">  <span class="comment">// 静态方法必须自己声明泛型</span></span><br><span class="line">  <span class="keyword">static</span> firstElement&lt;T&gt;(<span class="attr">array</span>: T[]): T | <span class="literal">undefined</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> array[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> filterByType&lt;T&gt;(<span class="attr">array</span>: <span class="built_in">any</span>[], <span class="attr">type</span>: <span class="keyword">new</span> () =&gt; T): T[] &#123;</span><br><span class="line">    <span class="keyword">return</span> array.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item <span class="keyword">instanceof</span> <span class="keyword">type</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-实际场景示例"><a href="#3-实际场景示例" class="headerlink" title="3. 实际场景示例"></a>3. 实际场景示例</h2><h3 id="场景1：数据映射器类"><a href="#场景1：数据映射器类" class="headerlink" title="场景1：数据映射器类"></a>场景1：数据映射器类</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在类级别声明泛型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataMapper</span>&lt;<span class="title class_">TInput</span>, <span class="title class_">TOutput</span>&gt; &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> mapper: (input: TInput) =&gt; TOutput</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方法不需要单独声明泛型</span></span><br><span class="line">  <span class="title function_">map</span>(<span class="attr">data</span>: <span class="title class_">TInput</span>): <span class="title class_">TOutput</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">mapper</span>(data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mapArray</span>(<span class="attr">data</span>: <span class="title class_">TInput</span>[]): <span class="title class_">TOutput</span>[] &#123;</span><br><span class="line">    <span class="keyword">return</span> data.<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="property">mapper</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> userMapper = <span class="keyword">new</span> <span class="title class_">DataMapper</span>&lt;<span class="title class_">RawUser</span>, <span class="title class_">User</span>&gt;(<span class="function"><span class="params">raw</span> =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">id</span>: raw.<span class="property">user_id</span>,</span><br><span class="line">  <span class="attr">name</span>: raw.<span class="property">user_name</span>,</span><br><span class="line">  <span class="attr">email</span>: raw.<span class="property">user_email</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = userMapper.<span class="title function_">mapArray</span>(rawUsers);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="场景2：混合使用"><a href="#场景2：混合使用" class="headerlink" title="场景2：混合使用"></a>场景2：混合使用</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ApiClient</span>&lt;<span class="title class_">TAuth</span> = <span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// 使用类级别的泛型</span></span><br><span class="line">  <span class="title function_">authenticate</span>(<span class="attr">auth</span>: <span class="title class_">TAuth</span>): <span class="variable language_">this</span> &#123;</span><br><span class="line">    <span class="comment">// 认证逻辑</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方法级别的独立泛型</span></span><br><span class="line">  <span class="keyword">async</span> get&lt;<span class="title class_">TResponse</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">TResponse</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用类泛型 + 方法泛型</span></span><br><span class="line">  <span class="keyword">async</span> post&lt;<span class="title class_">TRequest</span>, <span class="title class_">TResponse</span>&gt;(</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">TRequest</span></span><br><span class="line">  ): <span class="title class_">Promise</span>&lt;<span class="title class_">TResponse</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title class_">ApiClient</span>&lt;&#123; <span class="attr">token</span>: <span class="built_in">string</span> &#125;&gt;();</span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> client.<span class="property">get</span>&lt;<span class="title class_">User</span>&gt;(<span class="string">&#x27;/api/user/1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> client.<span class="property">post</span>&lt;<span class="title class_">CreateUserRequest</span>, <span class="title class_">CreateUserResponse</span>&gt;(</span><br><span class="line">  <span class="string">&#x27;/api/users&#x27;</span>,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;john@example.com&#x27;</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-最佳实践建议"><a href="#4-最佳实践建议" class="headerlink" title="4. 最佳实践建议"></a>4. 最佳实践建议</h2><h3 id="推荐在类级别声明的情况："><a href="#推荐在类级别声明的情况：" class="headerlink" title="推荐在类级别声明的情况："></a>推荐在类级别声明的情况：</h3><ul><li>当多个方法使用相同的类型时</li><li>当类型在整个类生命周期中保持一致时</li><li>当创建类型特定的实例时</li></ul><h3 id="推荐在方法级别声明的情况："><a href="#推荐在方法级别声明的情况：" class="headerlink" title="推荐在方法级别声明的情况："></a>推荐在方法级别声明的情况：</h3><ul><li>静态方法</li><li>工具方法，类型与类无关时</li><li>方法需要独立的类型参数时</li><li>当类型只在单个方法中使用时</li></ul><h3 id="示例对比："><a href="#示例对比：" class="headerlink" title="示例对比："></a>示例对比：</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 好的做法 - 相关方法共享类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Repository</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="title function_">findById</span>(<span class="attr">id</span>: <span class="built_in">number</span>): T | <span class="literal">undefined</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">  <span class="title function_">save</span>(<span class="attr">entity</span>: T): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 好的做法 - 独立工具方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Helpers</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> fetchJson&lt;T&gt;(<span class="attr">url</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 不必要的重复</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BadExample</span> &#123;</span><br><span class="line">  <span class="comment">// 每个方法都声明相同的泛型 - 冗余</span></span><br><span class="line">  findById&lt;T&gt;(<span class="attr">id</span>: <span class="built_in">number</span>): T | <span class="literal">undefined</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">  save&lt;T&gt;(<span class="attr">entity</span>: T): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>总结</strong>：只有在方法需要独立于类的泛型参数时，才需要在方法名后面写 <code>&lt;T&gt;</code>。如果多个方法共享相同的类型约束，应该在类级别声明泛型。</p><p>希望这些信息能帮助您。如果还有其他想了解的，随时可以留言。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;TypeScript 泛型（Generics）必须在方法名后面写 &lt;T&gt; 吗?&lt;br&gt;答案是不，不一定必须在方法名后面写 &lt;code&gt;&amp;lt;T&amp;gt;&lt;/code&gt;。泛型的声明位置取决于使用场景：&lt;/p&gt;</summary>
    
    
    
    <category term="前端" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="FrontEnd" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/"/>
    
    <category term="TypeScript" scheme="https://xuehuayu.cn/categories/%E5%89%8D%E7%AB%AF/FrontEnd/TypeScript/"/>
    
    
    <category term="TypeScript" scheme="https://xuehuayu.cn/tags/TypeScript/"/>
    
    <category term="Generics" scheme="https://xuehuayu.cn/tags/Generics/"/>
    
    <category term="泛型" scheme="https://xuehuayu.cn/tags/%E6%B3%9B%E5%9E%8B/"/>
    
    <category term="&lt;T&gt;" scheme="https://xuehuayu.cn/tags/T/"/>
    
  </entry>
  
</feed>
